var ko=Object.defineProperty;var Io=(t,e,o)=>e in t?ko(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var lt=(t,e,o)=>Io(t,typeof e!="symbol"?e+"":e,o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}})();function J(){}const it=t=>t;function co(t){return t()}function It(){return Object.create(null)}function ve(t){t.forEach(co)}function Ye(t){return typeof t=="function"}function Te(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Co(t){return Object.keys(t).length===0}function uo(t,...e){if(t==null){for(const n of e)n(void 0);return J}const o=t.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}function oe(t){let e;return uo(t,o=>e=o)(),e}function Me(t,e,o){t.$$.on_destroy.push(uo(e,o))}function Ct(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const fo=typeof window<"u";let yt=fo?()=>window.performance.now():()=>Date.now(),mt=fo?t=>requestAnimationFrame(t):J;const Oe=new Set;function ho(t){Oe.forEach(e=>{e.c(t)||(Oe.delete(e),e.f())}),Oe.size!==0&&mt(ho)}function gt(t){let e;return Oe.size===0&&mt(ho),{promise:new Promise(o=>{Oe.add(e={c:t,f:o})}),abort(){Oe.delete(e)}}}function u(t,e){t.appendChild(e)}function po(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Ao(t){const e=v("style");return e.textContent="/* empty */",To(po(t),e),e.sheet}function To(t,e){return u(t.head||t,e),e.sheet}function H(t,e,o){t.insertBefore(e,o||null)}function G(t){t.parentNode&&t.parentNode.removeChild(t)}function Ce(t,e){for(let o=0;o<t.length;o+=1)t[o]&&t[o].d(e)}function v(t){return document.createElement(t)}function U(t){return document.createTextNode(t)}function N(){return U(" ")}function vt(){return U("")}function re(t,e,o,n){return t.addEventListener(e,o,n),()=>t.removeEventListener(e,o,n)}function yo(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function M(t,e,o){o==null?t.removeAttribute(e):t.getAttribute(e)!==o&&t.setAttribute(e,o)}function $o(t){return Array.from(t.childNodes)}function ne(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ze(t,e){t.value=e??""}function pe(t,e,o,n){o==null?t.style.removeProperty(e):t.style.setProperty(e,o,"")}function ge(t,e,o){t.classList.toggle(e,!!o)}function mo(t,e,{bubbles:o=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:o,cancelable:n})}const Ve=new Map;let Qe=0;function So(t){let e=5381,o=t.length;for(;o--;)e=(e<<5)-e^t.charCodeAt(o);return e>>>0}function xo(t,e){const o={stylesheet:Ao(e),rules:{}};return Ve.set(t,o),o}function Xe(t,e,o,n,s,i,r,l=0){const a=16.666/n;let c=`{
`;for(let $=0;$<=1;$+=a){const L=e+(o-e)*i($);c+=$*100+`%{${r(L,1-L)}}
`}const f=c+`100% {${r(o,1-o)}}
}`,h=`__svelte_${So(f)}_${l}`,m=po(t),{stylesheet:w,rules:d}=Ve.get(m)||xo(m,t);d[h]||(d[h]=!0,w.insertRule(`@keyframes ${h} ${f}`,w.cssRules.length));const T=t.style.animation||"";return t.style.animation=`${T?`${T}, `:""}${h} ${n}ms linear ${s}ms 1 both`,Qe+=1,h}function et(t,e){const o=(t.style.animation||"").split(", "),n=o.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),s=o.length-n.length;s&&(t.style.animation=n.join(", "),Qe-=s,Qe||Do())}function Do(){mt(()=>{Qe||(Ve.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&G(e)}),Ve.clear())})}let Fe;function Ue(t){Fe=t}function Mt(){if(!Fe)throw new Error("Function called outside component initialization");return Fe}function Eo(t){Mt().$$.on_mount.push(t)}function jo(t){Mt().$$.on_destroy.push(t)}function Ro(){const t=Mt();return(e,o,{cancelable:n=!1}={})=>{const s=t.$$.callbacks[e];if(s){const i=mo(e,o,{cancelable:n});return s.slice().forEach(r=>{r.call(t,i)}),!i.defaultPrevented}return!0}}function go(t,e){const o=t.$$.callbacks[e.type];o&&o.slice().forEach(n=>n.call(this,e))}const Le=[],ct=[];let Pe=[];const At=[],Lo=Promise.resolve();let ut=!1;function No(){ut||(ut=!0,Lo.then(vo))}function Ae(t){Pe.push(t)}const rt=new Set;let je=0;function vo(){if(je!==0)return;const t=Fe;do{try{for(;je<Le.length;){const e=Le[je];je++,Ue(e),Oo(e.$$)}}catch(e){throw Le.length=0,je=0,e}for(Ue(null),Le.length=0,je=0;ct.length;)ct.pop()();for(let e=0;e<Pe.length;e+=1){const o=Pe[e];rt.has(o)||(rt.add(o),o())}Pe.length=0}while(Le.length);for(;At.length;)At.pop()();ut=!1,rt.clear(),Ue(t)}function Oo(t){if(t.fragment!==null){t.update(),ve(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ae)}}function Po(t){const e=[],o=[];Pe.forEach(n=>t.indexOf(n)===-1?e.push(n):o.push(n)),o.forEach(n=>n()),Pe=e}let We;function _t(){return We||(We=Promise.resolve(),We.then(()=>{We=null})),We}function xe(t,e,o){t.dispatchEvent(mo(`${e?"intro":"outro"}${o}`))}const Je=new Set;let _e;function qe(){_e={r:0,c:[],p:_e}}function ze(){_e.r||ve(_e.c),_e=_e.p}function se(t,e){t&&t.i&&(Je.delete(t),t.i(e))}function ue(t,e,o,n){if(t&&t.o){if(Je.has(t))return;Je.add(t),_e.c.push(()=>{Je.delete(t),n&&(o&&t.d(1),n())}),t.o(e)}else n&&n()}const bt={duration:0};function qo(t,e,o){const n={direction:"in"};let s=e(t,o,n),i=!1,r,l,a=0;function c(){r&&et(t,r)}function f(){const{delay:m=0,duration:w=300,easing:d=it,tick:T=J,css:$}=s||bt;$&&(r=Xe(t,0,1,w,m,d,$,a++)),T(0,1);const L=yt()+m,g=L+w;l&&l.abort(),i=!0,Ae(()=>xe(t,!0,"start")),l=gt(D=>{if(i){if(D>=g)return T(1,0),xe(t,!0,"end"),c(),i=!1;if(D>=L){const y=d((D-L)/w);T(y,1-y)}}return i})}let h=!1;return{start(){h||(h=!0,et(t),Ye(s)?(s=s(n),_t().then(f)):f())},invalidate(){h=!1},end(){i&&(c(),i=!1)}}}function zo(t,e,o){const n={direction:"out"};let s=e(t,o,n),i=!0,r;const l=_e;l.r+=1;let a;function c(){const{delay:f=0,duration:h=300,easing:m=it,tick:w=J,css:d}=s||bt;d&&(r=Xe(t,1,0,h,f,m,d));const T=yt()+f,$=T+h;Ae(()=>xe(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),gt(L=>{if(i){if(L>=$)return w(0,1),xe(t,!1,"end"),--l.r||ve(l.c),!1;if(L>=T){const g=m((L-T)/h);w(1-g,g)}}return i})}return Ye(s)?_t().then(()=>{s=s(n),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&s.tick&&s.tick(1,0),i&&(r&&et(t,r),i=!1)}}}function Tt(t,e,o,n){let i=e(t,o,{direction:"both"}),r=n?0:1,l=null,a=null,c=null,f;function h(){c&&et(t,c)}function m(d,T){const $=d.b-r;return T*=Math.abs($),{a:r,b:d.b,d:$,duration:T,start:d.start,end:d.start+T,group:d.group}}function w(d){const{delay:T=0,duration:$=300,easing:L=it,tick:g=J,css:D}=i||bt,y={start:yt()+T,b:d};d||(y.group=_e,_e.r+=1),"inert"in t&&(d?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),l||a?a=y:(D&&(h(),c=Xe(t,r,d,$,T,L,D)),d&&g(0,1),l=m(y,$),Ae(()=>xe(t,d,"start")),gt(F=>{if(a&&F>a.start&&(l=m(a,$),a=null,xe(t,l.b,"start"),D&&(h(),c=Xe(t,r,l.b,l.duration,0,L,i.css))),l){if(F>=l.end)g(r=l.b,1-r),xe(t,l.b,"end"),a||(l.b?h():--l.group.r||ve(l.group.c)),l=null;else if(F>=l.start){const q=F-l.start;r=l.a+l.d*L(q/l.duration),g(r,1-r)}}return!!(l||a)}))}return{run(d){Ye(i)?_t().then(()=>{i=i({direction:d?"in":"out"}),w(d)}):w(d)},end(){h(),l=a=null}}}function ce(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Wo(t,e){ue(t,1,1,()=>{e.delete(t.key)})}function Go(t,e,o,n,s,i,r,l,a,c,f,h){let m=t.length,w=i.length,d=m;const T={};for(;d--;)T[t[d].key]=d;const $=[],L=new Map,g=new Map,D=[];for(d=w;d--;){const C=h(s,i,d),p=o(C);let A=r.get(p);A?D.push(()=>A.p(C,e)):(A=c(p,C),A.c()),L.set(p,$[d]=A),p in T&&g.set(p,Math.abs(d-T[p]))}const y=new Set,F=new Set;function q(C){se(C,1),C.m(l,f),r.set(C.key,C),f=C.first,w--}for(;m&&w;){const C=$[w-1],p=t[m-1],A=C.key,j=p.key;C===p?(f=C.first,m--,w--):L.has(j)?!r.has(A)||y.has(A)?q(C):F.has(j)?m--:g.get(A)>g.get(j)?(F.add(A),q(C)):(y.add(j),m--):(a(p,r),m--)}for(;m--;){const C=t[m];L.has(C.key)||a(C,r)}for(;w;)q($[w-1]);return ve(D),$}function Ne(t){t&&t.c()}function $e(t,e,o){const{fragment:n,after_update:s}=t.$$;n&&n.m(e,o),Ae(()=>{const i=t.$$.on_mount.map(co).filter(Ye);t.$$.on_destroy?t.$$.on_destroy.push(...i):ve(i),t.$$.on_mount=[]}),s.forEach(Ae)}function Se(t,e){const o=t.$$;o.fragment!==null&&(Po(o.after_update),ve(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[])}function Uo(t,e){t.$$.dirty[0]===-1&&(Le.push(t),No(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function De(t,e,o,n,s,i,r=null,l=[-1]){const a=Fe;Ue(t);const c=t.$$={fragment:null,ctx:[],props:i,update:J,not_equal:s,bound:It(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:It(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=o?o(t,e.props||{},(h,m,...w)=>{const d=w.length?w[0]:m;return c.ctx&&s(c.ctx[h],c.ctx[h]=d)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](d),f&&Uo(t,h)),m}):[],c.update(),f=!0,ve(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const h=$o(e.target);c.fragment&&c.fragment.l(h),h.forEach(G)}else c.fragment&&c.fragment.c();e.intro&&se(t.$$.fragment),$e(t,e.target,e.anchor),vo()}Ue(a)}class Ee{constructor(){lt(this,"$$");lt(this,"$$set")}$destroy(){Se(this,1),this.$destroy=J}$on(e,o){if(!Ye(o))return J;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(o),()=>{const s=n.indexOf(o);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Co(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ho="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ho);const Re=[];function ke(t,e=J){let o;const n=new Set;function s(l){if(Te(t,l)&&(t=l,o)){const a=!Re.length;for(const c of n)c[1](),Re.push(c,t);if(a){for(let c=0;c<Re.length;c+=2)Re[c][0](Re[c+1]);Re.length=0}}}function i(l){s(l(t))}function r(l,a=J){const c=[l,a];return n.add(c),n.size===1&&(o=e(s,i)||J),l(t),()=>{n.delete(c),n.size===0&&o&&(o(),o=null)}}return{set:s,update:i,subscribe:r}}const B=20,O={EMPTY:"empty",RESIDENTIAL:"residential",COMMERCIAL:"commercial",INDUSTRIAL:"industrial",ROAD:"road",PARK:"park"},tt={[O.RESIDENTIAL]:100,[O.COMMERCIAL]:200,[O.INDUSTRIAL]:300,[O.ROAD]:10,[O.PARK]:50,[O.EMPTY]:5},Fo=Array(B).fill(null).map(()=>Array(B).fill(null).map(()=>({type:O.EMPTY,population:0,level:1,hasPower:!0,hasWater:!0}))),be=ke(Fo),ot=ke(5e3),He=ke(0),me=ke(0),ft=ke(null),Mo=ke({residential:50,commercial:0,industrial:0}),ye=ke([]),nt=ke([]),_o=ke([{id:1,author:{name:"Mayor",isSystem:!0},text:"Welcome to SimTwitty! Start building zones to attract denizens.",time:0}]),at=["I'm trapped! No road out of here.","How do I get to work? The road is gone!","I can't get any deliveries. Moving out!","Is this an island? Where did the road go?","My car is useless without a street."],Bo=["The commute is killing me. Moving closer to work.","Spending 4 hours in traffic? No thanks. I'm out.","I miss my family. I spend all my time driving.","Gas prices are too high for this drive.","I need a job closer to home."],$t=["The commute to {dest} is just too far from here!","I can't believe I have to drive all the way to {dest} every day.","Why is {dest} so far away? My car is crying.","Traffic to {dest} is a nightmare. I'm moving.","I love working at {dest}, but the drive is ruinous."],St=["Just moved in near {dest}. Convenient!","Love being so close to {dest}.","Great location! {dest} is just a short walk away.","Finally, a short commute to {dest}.","This spot is perfect. I can see {dest} from my window."],Yo=["The smog is unbearable. I can't breathe!","Moving to the countryside. This air is toxic.","My laundry turns grey when I hang it outside.","Coughing all day. I'm leaving this smog city.","It smells like burning tires here. Bye!"],Ko=["This neighborhood isn't what it used to be.","Time to move on.","Found a better place in another city.","Property values are tanking. Selling now!","Just don't like the vibe here anymore."],xt=["optimist","pessimist","pragmatist","activist","cynic"];function Dt(){return xt[Math.floor(Math.random()*xt.length)]}const Et={optimist:{supportive:["@Mayor I knew you'd come through! You're amazing!","@Mayor this is exactly what we needed. Thank you!","@Mayor I have faith in you, Mayor. Let's make this city great!","@Mayor seeing progress like this makes me smile. Keep it up!","@Mayor another win for our city! You're on a roll!"],dismissive:["@Mayor I'm sure you're doing your best. We'll figure it out!","@Mayor no worries, I'm confident things will improve.","@Mayor I still believe in you, Mayor!","@Mayor Rome wasn't built in a day. We can wait.","@Mayor hiccups happen. We'll bounce back!"],actionTaken:["@Mayor YES! This is incredible! I'm so happy right now!","@Mayor you actually did it! I knew you would!","@Mayor this changes everything! Thank you so much!","@Mayor proof that dreams come true! Best Mayor ever!","@Mayor I'm telling everyone I know about this!"],ignored:["@Mayor I'm sure you're busy. I can wait.","@Mayor no rush, Mayor. We're patient here.","@Mayor I still have hope things will get better.","@Mayor maybe next time! I'm staying positive.","@Mayor busy schedule, I get it. We're good."]},pessimist:{supportive:["@Mayor wow, you actually listened? I'm shocked.","@Mayor I guess that's something. Don't get my hopes up though.","@Mayor nice words. Let's see if you actually follow through.","@Mayor probably a fluke, but thanks anyway.","@Mayor I was ready to be disappointed, but... okay."],dismissive:["@Mayor figures. Just more empty promises.","@Mayor of course you don't care. Why would you?","@Mayor typical. I'm out of here.","@Mayor expected nothing and still disappointed.","@Mayor another day, another letdown from City Hall."],actionTaken:["@Mayor okay, I'll admit it. That actually helped.","@Mayor well, I didn't expect that. Maybe you're not so bad.","@Mayor fine, you did something right for once.","@Mayor don't think this fixes everything, but it's a start.","@Mayor I hate to say it, but good job."],ignored:["@Mayor I knew you wouldn't actually do anything.","@Mayor just as I expected. Useless.","@Mayor moving to a city with a competent mayor.","@Mayor why do I even bother asking?","@Mayor silence is loud. Message received."]},pragmatist:{supportive:["@Mayor good to see you're taking action. What's the timeline?","@Mayor solid response. How will this affect the budget?","@Mayor makes sense. Let's see the results.","@Mayor reasonable approach. Proceed.","@Mayor I appreciate the transparency."],dismissive:["@Mayor that doesn't address the core issue.","@Mayor nice sentiment, but what's the actual plan?","@Mayor words without action won't fix anything.","@Mayor efficient refusal, but a refusal nonetheless.","@Mayor that's not a solution, that's a deflection."],actionTaken:["@Mayor efficient. My commute is already 20% faster.","@Mayor the numbers don't lie. This actually works.","@Mayor finally, some practical solutions.","@Mayor property value up 2%. Acceptable.","@Mayor logical move. Glad you saw the data."],ignored:["@Mayor still waiting on concrete action.","@Mayor talk is cheap. Show me results.","@Mayor I'll move somewhere with real infrastructure.","@Mayor inefficiency at its finest.","@Mayor no response? Not very professional."]},activist:{supportive:["@Mayor YES! This is what real leadership looks like!","@Mayor I'm organizing a thank you rally. You in?","@Mayor this is the change we've been fighting for!","@Mayor the people's voice has been heard! Victory!","@Mayor solidarity! Thank you for standing with us!"],dismissive:["@Mayor that's not nearly enough. We demand more!","@Mayor half-measures won't cut it. We need real change!","@Mayor you're not listening to what we actually need.","@Mayor shameful! The citizens deserve better!","@Mayor we will not be silenced by your excuses!"],actionTaken:["@Mayor THIS is what we've been asking for! Keep it up!","@Mayor you're finally on the right side of history!","@Mayor the movement is working! Let's push for more!","@Mayor direct action gets results! Well done!","@Mayor power to the people! (And the Mayor, this time)."],ignored:["@Mayor we're not going away until you listen.","@Mayor the people demand action, not excuses!","@Mayor moving to a city that values its citizens.","@Mayor your silence speaks volumes about your priorities.","@Mayor ignore us at your peril. Election year is coming."]},cynic:{supportive:["@Mayor oh please, what's the catch?","@Mayor nice PR stunt. What are you really after?","@Mayor I'll believe it when I see it.","@Mayor who paid you to say that?","@Mayor sure, sure. And pigs fly."],dismissive:["@Mayor lol, you actually think that'll work?","@Mayor spare me the BS, Mayor.","@Mayor typical politician nonsense.","@Mayor yawn. Wake me up when you actually do something.","@Mayor is this a bot account? Feels like it."],actionTaken:["@Mayor okay, I'm mildly impressed. Don't let it go to your head.","@Mayor even a broken clock is right twice a day.","@Mayor fine, you did one thing right. Congrats.","@Mayor must be an election year if you're actually working.","@Mayor barely adequate. But I'll take it."],ignored:["@Mayor shocking. Absolutely shocking.","@Mayor I'm leaving before this city gets worse.","@Mayor you're a joke, and so is this city.","@Mayor exactly the incompetence I expected.","@Mayor 0/10 administration. Would not recommend."]}},jt=["@Mayor we need a road at {home}!","@Mayor can you fix the pollution near {home}?","@Mayor my commute from {home} is brutal!","@Mayor why is {home} so isolated?","@Mayor {home} needs better infrastructure!","@Mayor this city needs more jobs!","@Mayor the pollution is unbearable!","@Mayor we need better infrastructure!","@Mayor traffic is out of control!","@Mayor we're overcrowded here!"],Rt=["@{target} tell the Mayor to FOCUS! The city is burning (figuratively)!","@{target} is right, @Mayor stop distracted tweeting and build some roads!","@Mayor maybe less social media, more city planning? Listen to @{target}!","@Mayor your approval rating drops every time you tweet nonsense.","Seriously @Mayor? @{target} is waiting for a response and you tweet this?","@{target} remember that bridge to nowhere the Mayor built? Fix that first.","@Mayor I'm still waiting for water in Zone C, just saying. @{target} knows what's up.","@Mayor easy to tweet from your ivory tower while we sit in traffic. Right @{target}?","Yeah @{target}, the Mayor clearly doesn't care about our commute.","@Mayor we need more parks! #GreenCity cc: @{target}","Hey @{target}, tell the Mayor to build a stadium! Or at least a hot dog stand.","@Mayor forget roads, we need a monorail! #Monorail","Agreed with @{target}. More industrial zones! I love the smell of smog.","@{target} for Mayor! At least they reply."],Jo={park:["park","parks","green","tree","trees","nature","garden","grass","picnic"],job:["job","jobs","work","employment","unemployed","factory","factories","commercial","business","hire","hiring"],road:["road","roads","street","streets","traffic","commute","drive","driving","car","infrastructure"],pollution:["pollution","smog","dirty","air","smell","toxic","cough","smoke","industrial"],housing:["home","house","housing","apartment","residential","living","neighborhood","rent"]};function Zo(t){const e=t.toLowerCase(),o=[];for(const[s,i]of Object.entries(Jo))i.some(r=>e.includes(r))&&o.push(s);const n=e.includes("?")||/^(what|how|do|does|are|is|can|will|why|where|when|who)\b/i.test(e.trim());return{topics:o,isQuestion:n}}function Vo(t,e){const o=t.toLowerCase(),n=e.home?e.home.toLowerCase():"",s=e.work?e.work.toLowerCase():"";return(o.includes(n)||o.includes(s))&&(o.includes("build")||o.includes("fix")||o.includes("improve")||o.includes("road"))||o.includes("build")||o.includes("fix")||o.includes("improve")?"actionTaken":o.includes("sorry")||o.includes("thanks")||o.includes("appreciate")||o.includes("listen")||o.includes("understand")||o.includes("working on")?"supportive":o.includes("no")||o.includes("can't")||o.includes("won't")||o.includes("impossible")||o.includes("not possible")?"dismissive":"ignored"}function wt(t){const e=addrToCoord(t.home);if(!e)return{exists:!1,distance:999,quality:"none"};const o=oe(be),n=[];for(let l=0;l<B;l++)for(let a=0;a<B;a++)o[l][a].type===O.PARK&&n.push({x:a,y:l});if(n.length===0)return{exists:!1,distance:999,quality:"none"};const s=ht(e.x,e.y,n),i=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2));let r="far";return i<=3?r="close":i<=7&&(r="moderate"),{exists:!0,distance:Math.round(i),quality:r,address:Be(s.x,s.y)}}function st(t){if(!t.work)return{employed:!1,unemployedDays:t.unemployedDays||0,quality:t.unemployedDays>10?"desperate":"looking"};const e=addrToCoord(t.home),o=addrToCoord(t.work);if(!e||!o)return{employed:!0,commute:999,quality:"unknown"};const n=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2));let s="long";return n<=5?s="short":n<=10&&(s="moderate"),{employed:!0,commute:Math.round(n),quality:s,workAddress:Be(o.x,o.y),daysMissed:t.daysMissed||0}}function kt(t){const e=addrToCoord(t.home);if(!e)return{hasAccess:!1,quality:"none"};const o=oe(be),n=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];let s=0;for(const{dx:i,dy:r}of n){const l=e.x+i,a=e.y+r;l>=0&&l<B&&a>=0&&a<B&&o[a][l].type===O.ROAD&&s++}return{hasAccess:s>0,quality:s===0?"none":s>=2?"good":"basic"}}function bo(t){const e=addrToCoord(t.home);if(!e)return{level:0,quality:"unknown"};const o=oe(be),s=wo(o)[e.y][e.x];let i="clean";return s>20?i="toxic":s>10?i="bad":s>5&&(i="moderate"),{level:Math.round(s),quality:i}}function Qo(t){return t.work&&!t.daysMissed&&t.unemployedDays===0?"happy":!t.work||t.unemployedDays>5?"desperate":t.daysMissed>3||t.unemployedDays>15?"angry":"neutral"}function Xo(t,e,o){const n=t.personality||"optimist",s=Qo(t),{topics:i,isQuestion:r}=Zo(e);if(r&&i.length>0){const a=en(t,i);if(a)return a}if(t.lastMention&&!t.lastMention.resolved&&i.length>0){const a=tn(t,i,e);if(a)return ye.update(c=>{const f=c.findIndex(h=>h.id===t.id);if(f!==-1){const h={...c[f]};h.lastMention&&(h.lastMention.resolved=!0),c[f]=h}return c}),a}if(i.length>0&&!r){const a=on(t,i,e);if(a)return a}let l=Et[n][o]||Et[n].ignored;return s==="desperate"&&o==="ignored"&&(l=["@Mayor I'm leaving. This city doesn't care about us.","@Mayor I can't afford to stay here anymore.","@Mayor goodbye. I'm done waiting."]),s==="angry"&&o==="dismissive"&&(l=["@Mayor you just cost me my home. I hope you're happy.","@Mayor I trusted you. Never again.","@Mayor you've lost my vote forever."]),s==="happy"&&o==="supportive"&&(l=["@Mayor you're the best! This city is amazing!","@Mayor thanks for everything you do!","@Mayor I love living here!"]),l[Math.floor(Math.random()*l.length)]}function en(t,e,o){const n=[];for(const s of e){if(s==="park"){const i=wt(t);i.exists&&i.quality==="close"?n.push(`@Mayor Yes! I love the park at ${i.address}. I go there all the time.`):i.exists&&i.quality==="moderate"?n.push(`@Mayor There's one at ${i.address}, but it's a bit of a walk.`):i.exists&&i.quality==="far"?n.push(`@Mayor The nearest park is at ${i.address}. Too far for me honestly.`):n.push("@Mayor What park? I don't see any green space around here.")}if(s==="job"){const i=st(t);i.employed?i.quality==="short"?n.push(`@Mayor I work at ${i.workAddress}. The commute is great!`):i.quality==="moderate"?n.push(`@Mayor I have a job at ${i.workAddress}. Commute could be better.`):n.push(`@Mayor I work at ${i.workAddress}, but the commute is brutal.`):i.unemployedDays>20?n.push(`@Mayor Still unemployed. It's been ${i.unemployedDays} days now.`):n.push("@Mayor Looking for work. No luck yet.")}if(s==="road"){const i=kt(t),r=st(t);i.hasAccess?r.employed&&r.daysMissed>0?n.push("@Mayor The roads are broken. I can't get to work!"):i.quality==="good"?n.push("@Mayor Road access is fine. No complaints there."):n.push("@Mayor We have a road, but traffic is getting bad."):n.push("@Mayor No road access here! I'm basically trapped.")}if(s==="pollution"){const i=bo(t);i.quality==="toxic"?n.push("@Mayor The air is disgusting! I can barely breathe here."):i.quality==="bad"?n.push("@Mayor Pollution is pretty bad. I smell the factories every morning."):i.quality==="moderate"?n.push("@Mayor Air quality could be better, but it's tolerable."):n.push("@Mayor Air is clean here. No pollution issues.")}s==="housing"&&n.push(`@Mayor I live at ${t.home}. It's home.`)}return n.length>1?n.slice(0,2).join(" "):n.length===1?n[0]:null}function tn(t,e,o){if(!t.lastMention)return null;const n=t.lastMention.topic;if(oe(me)-t.lastMention.time,!e.includes(n))return null;let i=!1,r=null;if(n==="road"){const l=kt(t);l.hasAccess&&l.quality!=="none"&&(i=!0,r="@Mayor You actually fixed the road issue! Thank you!")}else if(n==="park"){const l=wt(t);l.exists&&l.quality!=="far"&&(i=!0,r="@Mayor The new park is great! Thanks for listening.")}else if(n==="job")st(t).employed&&(i=!0,r="@Mayor I found work! Things are looking up.");else if(n==="pollution"){const l=bo(t);(l.quality==="clean"||l.quality==="moderate")&&(i=!0,r="@Mayor Air quality improved! I can breathe again.")}if(!i&&(o.toLowerCase().includes("fix")||o.toLowerCase().includes("build")||o.toLowerCase().includes("working"))){const l=t.personality||"optimist";l==="optimist"?r="@Mayor I appreciate you trying! Hope it works out.":l==="pessimist"?r="@Mayor I'll believe it when I see it.":l==="pragmatist"?r="@Mayor Okay, but I need to see results soon.":r="@Mayor Thanks for the update, Mayor."}return r}function on(t,e,o){const n=o.toLowerCase();if(!(n.includes("built")||n.includes("build")||n.includes("added")||n.includes("fixed")))return null;for(const i of e){if(i==="park"){const r=wt(t);if(r.exists){if(r.quality==="far")return`@Mayor There's a park, but it's way too far from me at ${r.address}.`}else return"@Mayor What park? I don't see any parks around here."}if(i==="road"&&!kt(t).hasAccess)return"@Mayor Fixed the roads? I still don't have road access!";if(i==="job"&&!st(t).employed)return"@Mayor More jobs? I'm still unemployed!"}return null}function nn(t,e){const o=oe(me);ye.update(n=>{const s=n.findIndex(i=>i.id===t.id);if(s!==-1){const i={...n[s]};i.lastMention={topic:e,time:o,resolved:!1},n[s]=i}return n})}function sn(t){let e=jt[Math.floor(Math.random()*jt.length)];return e=e.replace("{home}",t.home||"here"),e}function Ge(){const t=["Urban","City","Metro","Town","Village","Street","Road","Lane","Park","Zone"],e=["Planner","Dweller","Sim","Citizen","Neighbor","Walker","Driver","Builder","Fan","Critic"];return t[Math.floor(Math.random()*t.length)]+e[Math.floor(Math.random()*e.length)]+Math.floor(Math.random()*1e3)}function ln(t){const e=oe(me),o=oe(ye);if(t){if(t.denizen)return t.denizen;if(t.x!=null&&t.y!=null){const a=o.find(c=>c.home===he(t.x,t.y));if(a)return a}}const n=o.filter(a=>!a.left);if(n.length>0)return n[Math.floor(Math.random()*n.length)];const s=Ge();let i="Homeless",r=null,l=e;return t&&t.type===O.RESIDENTIAL&&t.x!=null?i=he(t.x,t.y):i=he(Math.floor(Math.random()*B),Math.floor(Math.random()*B)),{name:s,home:i,work:r,since:l,history:[{type:"move_in",time:l,home:i}],isSystem:!1}}function dt(t,e,o){const n=Be(e,o);if(t===O.COMMERCIAL){const s=["Commerce Square","The Market","Shopping Center","Mall","Corner Store","Business Plaza","Trade Center","Retail Park"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}else if(t===O.INDUSTRIAL){const s=["Industrial Park","Factory District","The Works","Manufacturing Hub","Tech Park","Warehouse Zone","Power Station","Refinery"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}else if(t===O.RESIDENTIAL){const s=["The Apartments","Housing Block","Residences","Living Quarters","The Lofts","Condos","Villas","Estates"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}else if(t===O.PARK){const s=["Green Park","City Garden","Recreation Area","The Commons","Nature Reserve","Playground","Central Park","Botanical Garden"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}return`Zone at ${n}`}function ht(t,e,o){let n=999,s=null;for(const i of o){const r=Math.sqrt(Math.pow(i.x-t,2)+Math.pow(i.y-e,2));r<n&&(n=r,s=i)}return s}function he(t,e){const o=String.fromCharCode(65+e),n=t+1;return`${o}${n}`}function Be(t,e){const o=String.fromCharCode(65+e),n=t+1,s=n%10,i=n%100;let r="th";return s==1&&i!=11&&(r="st"),s==2&&i!=12&&(r="nd"),s==3&&i!=13&&(r="rd"),`${o} St & ${n}${r}`}function we(t,e=null,o=null){_o.update(n=>{let s=e;return s?typeof s=="string"&&(s={name:s,isSystem:!0}):s=ln(o),[{id:Date.now()+Math.random(),author:s,text:t,time:oe(me)},...n].slice(0,50)})}let Ke=[];function rn(t){const o=oe(ye).filter(i=>i.name!==t&&!i.left);if(o.length<3)return;const n=3+Math.floor(Math.random()*3),s=[];for(let i=0;i<n;i++)if(o.length>0){const r=Math.floor(Math.random()*o.length);s.push(o[r]),o.splice(r,1)}nt.update(i=>{const r=[...i],l=oe(me);return s.forEach((a,c)=>{let f=Rt[Math.floor(Math.random()*Rt.length)];f=f.replace("{target}",t),r.push({denizenName:a.name,playerTweet:"",forcedResponse:f,respondAt:l+2+c+Math.floor(Math.random()*2)})}),r})}function an(t,e){const o=oe(me);Ke.filter(s=>s.name===t&&o-s.time<60).length>=1&&rn(t),Ke.push({name:t,time:o}),Ke=Ke.filter(s=>o-s.time<100),nt.update(s=>{const i=o+1+Math.floor(Math.random()*3);return[...s,{denizenName:t,playerTweet:e,respondAt:i}]})}function cn(t){const e=t.match(/@(\w+)/);return e?e[1]:null}function un(){me.update(C=>C+1);const t=oe(me),e=[],o=[],n=[],s=[],i=new Set,r=new Set,l=(C,p,A)=>{s.push({text:C,author:p,context:A})},a=oe(be);oe(He);let c=0,f=0;a.forEach(C=>{C.forEach(p=>{p.type===O.RESIDENTIAL?c+=p.population:(p.type===O.COMMERCIAL||p.type===O.INDUSTRIAL)&&(f+=p.population)})});let h=50+(f-c),m=(c-f)*.5,w=(c-f)*.5;const d=C=>Math.max(-100,Math.min(100,C));h=d(h),m=d(m),w=d(w),Mo.set({residential:h,commercial:m,industrial:w});const{roadNetworkMap:T,networks:$}=dn(a),L=wo(a),g=C=>{if(!C)return null;try{const p=C.match(/[A-Z]+/),A=C.match(/\d+/);if(!p||!A)return null;const j=p[0],_=parseInt(A[0]),K=j.charCodeAt(0)-65;return{x:_-1,y:K}}catch{return null}},D=f-c;let y=0;f>0&&D>0&&(y=Math.min(1,D/f*2)),be.update(C=>{let p=0;const A=C.map(x=>x.map(S=>({...S,traffic:0}))),j=oe(ye),_=Array(B).fill(null).map(()=>Array(B).fill(0)),K=new Map;for(const x of j)if(x.home&&x.work&&!x.left){const S=g(x.home),k=g(x.work);if(S&&k){const Z=C[S.y][S.x],P=C[k.y][k.x];if(!(Z.type!==O.RESIDENTIAL||P.type!==O.COMMERCIAL&&P.type!==O.INDUSTRIAL)){const te=Nt(S.x,S.y,C),W=Nt(k.x,k.y,C);if(te.length>0&&W.length>0){const Y=`${S.x},${S.y}-${k.x},${k.y}`;let b=K.get(Y);if(b||(b=fn(te,W,C),b&&K.set(Y,b)),b){for(const I of b)_[I.y][I.x]+=1;r.add(x.id)}else i.add(x.id)}else i.add(x.id)}}}new Set(j.filter(x=>x.lostJob).map(x=>x.id));for(let x=0;x<B;x++)for(let S=0;S<B;S++)A[x][S].type===O.ROAD&&(A[x][S].traffic=_[x][S]);for(let x=0;x<B;x++)for(let S=0;S<B;S++){const k=A[x][S];let Z=null,P=!1;const te=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:W,dy:Y}of te){const b=S+W,I=x+Y;if(b>=0&&b<B&&I>=0&&I<B&&C[I][b].type===O.ROAD&&(P=!0,Z=T[I][b],Z))break}if(k.type===O.RESIDENTIAL){const W=L[x][S];if(P&&Z){const Y=$.get(Z);let b=999;Y&&Y.jobTiles.length>0&&(b=Lt(S,x,Y.jobTiles));const R=b<=15;let z=h/100;if(W>5&&(z-=.5),W>20&&(z-=1),b<5?z+=.2:b>10&&(z-=.1),R&&z>0){if(k.population<50*k.level&&Math.random()<z&&(k.population+=1,e.push({x:S,y:x}),Math.random()<.05&&R&&Y&&Y.jobTiles.length>0)){const E=ht(S,x,Y.jobTiles);if(E){const X=a[E.y][E.x],V=dt(X.type,E.x,E.y),ee=St[Math.floor(Math.random()*St.length)],Q={x:S,y:x,type:k.type,jobX:E.x,jobY:E.y,isGrowth:!0};l(ee.replace("{dest}",V),null,Q)}}}else if(k.population>0&&(!R||W>20||z<-.2)&&(k.population-=1,o.push({x:S,y:x}),Math.random()<.1)){let E=Ko,X=null,V=null;if(!P)E=at;else if(W>20)E=Yo;else if(!R){if(Y&&Y.jobTiles.length>0){const Q=ht(S,x,Y.jobTiles);if(Q){const ie=a[Q.y][Q.x],fe=dt(ie.type,Q.x,Q.y);X=$t[Math.floor(Math.random()*$t.length)].replace("{dest}",fe),V={jobX:Q.x,jobY:Q.y}}}X||(E=Bo)}const ee={x:S,y:x,type:k.type,isLeaving:!0,...V};l(X||E[Math.floor(Math.random()*E.length)],null,ee)}}else if(k.population>0&&(k.population-=1,o.push({x:S,y:x}),Math.random()<.1)){const Y={x:S,y:x,type:k.type,isLeaving:!0};l(at[Math.floor(Math.random()*at.length)],null,Y)}p+=k.population}else if(k.type===O.COMMERCIAL)if(P&&Z){const W=$.get(Z);let Y=999;W&&W.resTiles.length>0&&(Y=Lt(S,x,W.resTiles)),Y<=20&&m>0?k.population<25*k.level&&Math.random()<m/100&&(k.population+=1,n.push({x:S,y:x,type:k.type})):k.population>0?(Y>20?(k.daysIsolated=(k.daysIsolated||0)+1,k.daysIsolated>=7&&(k.population=0,k.daysIsolated=0)):k.daysIsolated=0,k.population>0&&(m<-20||Math.random()<y)&&(Math.random()<.05||Math.random()<y)&&(k.population-=1)):k.daysIsolated=0}else k.population>0&&(k.population=0);else if(k.type===O.INDUSTRIAL)if(P&&Z){const W=$.get(Z);W&&W.resTiles.length>0&&w>0?k.population<25*k.level&&Math.random()<w/100&&(k.population+=1,n.push({x:S,y:x,type:k.type})):k.population>0?(!W||W.resTiles.length===0?(k.daysIsolated=(k.daysIsolated||0)+1,k.daysIsolated>=7&&(k.population=0,k.daysIsolated=0)):k.daysIsolated=0,k.population>0&&(w<-20||Math.random()<y)&&(Math.random()<.05||Math.random()<y)&&(k.population-=1)):k.daysIsolated=0}else k.population>0&&(k.population=0)}return He.set(p),A}),ye.update(C=>{let p=[...C];const A=oe(be),j=new Map;for(const b of p)b.work&&!b.left&&j.set(b.work,(j.get(b.work)||0)+1);const _=[];for(let b=0;b<B;b++)for(let I=0;I<B;I++){const R=A[b][I];if(R.type===O.COMMERCIAL||R.type===O.INDUSTRIAL){const z=he(I,b),E=j.get(z)||0,X=R.population-E,V=new Set,ee=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:Q,dy:ie}of ee){const fe=I+Q,Ie=b+ie;if(fe>=0&&fe<B&&Ie>=0&&Ie<B&&A[Ie][fe].type===O.ROAD){const le=T[Ie][fe];le&&V.add(le)}}for(let Q=0;Q<X;Q++)_.push({x:I,y:b,type:R.type,addr:z,networks:Array.from(V)})}}for(let b=_.length-1;b>0;b--){const I=Math.floor(Math.random()*(b+1));[_[b],_[I]]=[_[I],_[b]]}const K=b=>{const I=g(b);if(!I)return-1;const R=new Set,z=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:E,dy:X}of z){const V=I.x+E,ee=I.y+X;if(V>=0&&V<B&&ee>=0&&ee<B&&A[ee][V].type===O.ROAD){const Q=T[ee][V];Q&&R.add(Q)}}return _.findIndex(E=>E.networks.some(X=>R.has(X)))},x=[],S=[],k=[];for(let b=0;b<p.length;b++){const I=p[b];let R=!1;r.has(I.id)?I.daysMissed>0&&(I.daysMissed=0,R=!0):i.has(I.id)&&(I.daysMissed=(I.daysMissed||0)+1,R=!0,I.daysMissed>=7&&(I.work&&l("Fired for not showing up!",I,{x:-1,y:-1}),I.work=null,I.daysMissed=0,I.unemployedDays=0,I.history.push({type:"fired",time:t}))),!I.work&&!I.left?(I.unemployedDays=(I.unemployedDays||0)+1,R=!0,I.unemployedDays>30&&S.push({x:-1,y:-1,denizenId:I.id})):I.work&&I.unemployedDays>0&&(I.unemployedDays=0,R=!0),R&&(p[b]={...I})}let Z=[...o],P=[...e];for(;Z.length>0&&P.length>0;){const b=Z.shift(),I=P.shift();x.push({from:b,to:I})}S.push(...Z),k.push(...P);for(const b of x){const I=he(b.from.x,b.from.y),R=he(b.to.x,b.to.y),z=p.findIndex(E=>E.home===I&&!E.left);if(z!==-1){const E={...p[z]};if(E.history=[...E.history||[],{type:"move",time:t,from:I,to:R}],E.home=R,!E.work&&_.length>0){const X=K(E.home);if(X!==-1){const V=_.splice(X,1)[0];E.work=V.addr,E.history.push({type:"new_job",time:t,work:E.work})}}if(p[z]=E,Math.random()<.1){const X={x:b.to.x,y:b.to.y,isGrowth:!0};l(`Moved from ${I} to ${R}. Fresh start!`,E,X)}}else S.push(b.from),k.push(b.to)}if(_.length>0)for(let b=0;b<p.length&&_.length!==0;b++){const I=p[b];if(!I.left&&!I.work){const R=K(I.home);if(R!==-1){const z=_.splice(R,1)[0],E=z.addr,X={...I};if(X.work=E,X.history=[...I.history||[],{type:"new_job",time:t,work:E}],p[b]=X,Math.random()<.3){const V=[`Finally got a job at ${E}!`,`Hired! Starting work at ${E}.`,`Off to work at ${E}. So happy!`,`Unemployment over. Hello ${E}.`],ee=V[Math.floor(Math.random()*V.length)];l(ee,X,{x:z.x,y:z.y,type:z.type})}}}}for(const b of S){const I=he(b.x,b.y),R=p.findIndex(z=>z.home===I&&!z.left);if(R!==-1){const z={...p[R]};z.left=t,z.history=[...z.history||[],{type:"left_city",time:t}];for(const E of s)E.context&&E.context.isLeaving&&E.context.x===b.x&&E.context.y===b.y&&(E.author||(E.author=z));p[R]=z}}const te=[];for(const b of k){const I=he(b.x,b.y);let R=null;if(_.length>0){const E=K(I);E!==-1&&(R=_.splice(E,1)[0].addr)}const z={id:Ge()+Math.random(),name:Ge(),home:I,work:R,since:t,history:[{type:"move_in",time:t,home:I}],isSystem:!1,personality:Dt(),playerInteractions:[],lastMention:null};te.push(z),p.push(z)}for(const b of s){let I=b.author;if(!I&&b.context){if(b.context.isGrowth){let R=te.find(z=>z.home===he(b.context.x,b.context.y));if(!R){const z=he(b.context.x,b.context.y);R=p.find(E=>E.home===z&&!E.left)}R&&(I=R)}else if(!b.context.isLeaving){if(b.context.x!=null){const R=p.find(z=>z.home===he(b.context.x,b.context.y)&&!z.left);R&&(I=R)}}}we(b.text,I,b.context)}const W=new Map,Y=new Map;for(let b=0;b<p.length;b++){const I=p[b];I.left||(I.home&&(W.has(I.home)||W.set(I.home,[]),W.get(I.home).push(b)),I.work&&(Y.has(I.work)||Y.set(I.work,[]),Y.get(I.work).push(b)))}for(let b=0;b<B;b++)for(let I=0;I<B;I++){const R=A[b][I],z=he(I,b),E=W.get(z)||[];if(R.type===O.RESIDENTIAL){if(E.length>R.population){const V=E.length-R.population;for(let ee=0;ee<V;ee++){const Q=E.pop(),ie=p[Q],fe={...ie,left:t,history:[...ie.history||[],{type:"evicted",time:t}]};p[Q]=fe}}else if(E.length<R.population){const V=R.population-E.length;for(let ee=0;ee<V;ee++){const Q={id:Ge()+Math.random(),name:Ge(),home:z,work:null,since:t,history:[{type:"drift_correction_spawn",time:t,home:z}],isSystem:!1,personality:Dt(),playerInteractions:[],lastMention:null};p.push(Q)}}}else if(E.length>0)for(const V of E){const ee=p[V],Q={...ee,left:t,history:[...ee.history||[],{type:"evicted_bulldoze",time:t}]};p[V]=Q}const X=Y.get(z)||[];if(R.type===O.COMMERCIAL||R.type===O.INDUSTRIAL)if(X.length>R.population){const V=X.length-R.population;for(let ee=0;ee<V;ee++){const Q=X.pop(),ie=p[Q],fe={...ie,work:null,history:[...ie.history||[],{type:"fired_excess",time:t}]};p[Q]=fe,ie.isSystem||l("Laid off due to downsizing.",fe,{x:I,y:b,type:R.type})}}else X.length<R.population}for(let b=0;b<p.length;b++){const I=p[b];if(!I.left&&I.work){const R=g(I.work);let z=!1;if(R){const E=A[R.y][R.x];(E.type===O.COMMERCIAL||E.type===O.INDUSTRIAL)&&(z=!0)}if(!z){const E={...I,work:null,history:[...I.history||[],{type:"workplace_demolished",time:t}]};p[b]=E}}}return p});{const C=oe(ye),p=new Map;for(const A of C)!A.left&&A.work&&p.set(A.work,(p.get(A.work)||0)+1);be.update(A=>A.map((j,_)=>j.map((K,x)=>{if(K.type===O.COMMERCIAL||K.type===O.INDUSTRIAL){const S=he(x,_),k=p.get(S)||0;if(K.population>k)return{...K,population:k}}return K})))}if(e.length>0&&Math.random()<.05){const C=["Moving in today! So excited.","Boxes unpacked. Hello city!","Just got the keys to my new place.","New in town, looking for recommendations.","Wow, this city is growing fast!"],p=oe(ye).filter(A=>A.since===t&&!A.isSystem);if(p.length>0){const A=p[Math.floor(Math.random()*p.length)];we(C[Math.floor(Math.random()*C.length)],A)}}if(Math.random()<.01){const C=["I love the smell of industry in the morning.","We need more parks!","Traffic is getting bad.","Is there a coffee shop nearby?","The mayor is doing a great job... I think.","Why is the power always out? Oh wait, it works."];we(C[Math.floor(Math.random()*C.length)])}const q=oe(nt).filter(C=>C.respondAt===t);for(const C of q){const p=oe(ye).find(A=>A.name===C.denizenName&&!A.left);if(p)if(C.forcedResponse)we(C.forcedResponse,p);else{const A=Vo(C.playerTweet,p),j=Xo(p,C.playerTweet,A);we(j,p)}}if(nt.update(C=>C.filter(p=>p.respondAt>t)),oe(me)%120===0&&Math.random()<.3){const p=oe(ye).filter(A=>!A.left&&(A.unemployedDays>10||A.daysMissed>3||A.work&&oe(me)-A.since>50));if(p.length>0){const A=p[Math.floor(Math.random()*p.length)],j=sn(A);let _="general";j.includes("road")||j.includes("commute")?_="road":j.includes("pollution")?_="pollution":j.includes("job")?_="job":j.includes("infrastructure")&&(_="road"),nn(A,_),we(j,A)}}oe(me)%5===0&&ot.update(C=>C+Math.floor(oe(He)*.5))}function Lt(t,e,o){let n=999;for(const s of o){const i=Math.sqrt(Math.pow(s.x-t,2)+Math.pow(s.y-e,2));i<n&&(n=i)}return n}function wo(t){const e=Array(B).fill(null).map(()=>Array(B).fill(0)),o=[];for(let n=0;n<B;n++)for(let s=0;s<B;s++)t[n][s].type===O.INDUSTRIAL&&o.push({x:s,y:n,intensity:10+t[n][s].population});if(o.length>0)for(let n=0;n<B;n++)for(let s=0;s<B;s++){let i=0;for(const r of o){const l=Math.sqrt(Math.pow(r.x-s,2)+Math.pow(r.y-n,2));l<8&&(i+=r.intensity/(l+1))}e[n][s]=i}return e}function Nt(t,e,o){const n=[],s=[{dx:0,dy:0},{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:i,dy:r}of s){const l=t+i,a=e+r;l>=0&&l<B&&a>=0&&a<B&&o[a][l].type===O.ROAD&&n.push({x:l,y:a})}return n}function fn(t,e,o){if(!t||t.length===0||!e||e.length===0)return null;const n=new Set(e.map(r=>`${r.x},${r.y}`)),s=t.map(r=>({x:r.x,y:r.y,path:[{x:r.x,y:r.y}]})),i=new Set(t.map(r=>`${r.x},${r.y}`));for(;s.length>0;){const{x:r,y:l,path:a}=s.shift();if(n.has(`${r},${l}`))return a;const c=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:f,dy:h}of c){const m=r+f,w=l+h;m>=0&&m<B&&w>=0&&w<B&&!i.has(`${m},${w}`)&&o[w][m].type===O.ROAD&&(i.add(`${m},${w}`),s.push({x:m,y:w,path:[...a,{x:m,y:w}]}))}}return null}function dn(t){const e=new Map,o=Array(B).fill(null).map(()=>Array(B).fill(0));let n=1;const s=new Set;for(let i=0;i<B;i++)for(let r=0;r<B;r++)if(t[i][r].type===O.ROAD&&!s.has(`${r},${i}`)){const l=n++;e.set(l,{jobTiles:[],resTiles:[],roadCount:0});const a=[{x:r,y:i}];for(s.add(`${r},${i}`),o[i][r]=l,e.get(l).roadCount++;a.length>0;){const{x:c,y:f}=a.shift();[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(({dx:m,dy:w})=>{const d=c+m,T=f+w;if(d>=0&&d<B&&T>=0&&T<B){const $=t[T][d];if($.type===O.ROAD)s.has(`${d},${T}`)||(s.add(`${d},${T}`),o[T][d]=l,e.get(l).roadCount++,a.push({x:d,y:T}));else{const L=e.get(l);$.type===O.RESIDENTIAL?L.resTiles.some(g=>g.x===d&&g.y===T)||L.resTiles.push({x:d,y:T}):($.type===O.COMMERCIAL||$.type===O.INDUSTRIAL)&&(L.jobTiles.some(g=>g.x===d&&g.y===T)||L.jobTiles.push({x:d,y:T}))}}})}}return{roadNetworkMap:o,networks:e}}function hn(t,e,o){const n=oe(ot),s=tt[o];if(n>=s){const r=oe(be)[e][t];if(r.type===O.ROAD&&o!==O.ROAD){if(Math.random()<.7){const l=Be(t,e),a=[`@Mayor Hey! I used the road at ${l} to get to work!`,`@Mayor My commute just got ruined by work at ${l}.`,`@Mayor Why are we destroying infrastructure at ${l}?`,`@Mayor Now I have to take the long way around ${l}.`,`@Mayor Bulldozers at ${l} woke me up!`];we(a[Math.floor(Math.random()*a.length)])}}else if(r.type!==o&&o!==O.EMPTY&&o!==O.ROAD&&Math.random()<.4){const l=Be(t,e),a=dt(o,t,e);let c=[];o===O.RESIDENTIAL?c=[`New housing coming to ${l}. Nice!`,`Looks like they are building ${a}.`,`More neighbors at ${l}. Hope they are quiet.`,`Finally developing the lot at ${l}.`]:o===O.COMMERCIAL?c=[`Ooh, a new shop opening at ${l}?`,`I heard ${a} is being built.`,`Traffic is going to be bad at ${l} with all the shoppers.`,`Can't wait to visit ${a}!`]:o===O.INDUSTRIAL?c=[`Ugh, they are building a factory at ${l}.`,`There goes the neighborhood. ${a} is huge.`,`More jobs at ${l}, but at what cost?`,`I hope ${a} doesn't smell bad.`]:o===O.PARK&&(c=[`Yay! A new park at ${l}.`,`Love that they preserved green space at ${l}.`,`Going to take my dog to ${a}.`,`Picnic time at ${l}!`]),c.length>0&&we(c[Math.floor(Math.random()*c.length)])}ot.update(l=>l-s),be.update(l=>{const a=[...l];return a[e][t]={...a[e][t],type:o,population:0,level:1},a})}}function Ot(t,e,o){const n=t.slice();return n[10]=e[o],n}function pn(t){let e,o,n,s,i,r,l,a,c=t[1].length+"",f,h,m,w,d=t[1].filter(qt).length+"",T,$,L,g,D=t[1].filter(zt).length+"",y,F,q,C,p,A,j,_,K,x=ce(t[3]),S=[];for(let k=0;k<x.length;k+=1)S[k]=Pt(Ot(t,x,k));return{c(){e=v("section"),o=v("h3"),o.textContent="Denizen Debugger",n=N(),s=v("input"),i=N(),r=v("div"),l=v("span"),a=U("Total: "),f=U(c),h=N(),m=v("span"),w=U("Active: "),T=U(d),$=N(),L=v("span"),g=U("Employed: "),y=U(D),F=N(),q=v("div"),C=v("table"),p=v("thead"),p.innerHTML='<tr><th class="svelte-1d5o944">Name</th> <th class="svelte-1d5o944">Home</th> <th class="svelte-1d5o944">Work</th> <th class="svelte-1d5o944">Status</th> <th class="svelte-1d5o944">Missed</th> <th class="svelte-1d5o944">Unemployed</th></tr>',A=N(),j=v("tbody");for(let k=0;k<S.length;k+=1)S[k].c();M(o,"class","svelte-1d5o944"),M(s,"type","text"),M(s,"placeholder","Search name, home, work..."),M(s,"class","search-input svelte-1d5o944"),M(r,"class","stats-row svelte-1d5o944"),M(C,"class","svelte-1d5o944"),M(q,"class","table-container svelte-1d5o944"),M(e,"class","debug-section svelte-1d5o944")},m(k,Z){H(k,e,Z),u(e,o),u(e,n),u(e,s),Ze(s,t[0]),u(e,i),u(e,r),u(r,l),u(l,a),u(l,f),u(r,h),u(r,m),u(m,w),u(m,T),u(r,$),u(r,L),u(L,g),u(L,y),u(e,F),u(e,q),u(q,C),u(C,p),u(C,A),u(C,j);for(let P=0;P<S.length;P+=1)S[P]&&S[P].m(j,null);_||(K=re(s,"input",t[8]),_=!0)},p(k,Z){if(Z&1&&s.value!==k[0]&&Ze(s,k[0]),Z&2&&c!==(c=k[1].length+"")&&ne(f,c),Z&2&&d!==(d=k[1].filter(qt).length+"")&&ne(T,d),Z&2&&D!==(D=k[1].filter(zt).length+"")&&ne(y,D),Z&8){x=ce(k[3]);let P;for(P=0;P<x.length;P+=1){const te=Ot(k,x,P);S[P]?S[P].p(te,Z):(S[P]=Pt(te),S[P].c(),S[P].m(j,null))}for(;P<S.length;P+=1)S[P].d(1);S.length=x.length}},d(k){k&&G(e),Ce(S,k),_=!1,K()}}}function yn(t){let e,o,n;return{c(){e=v("section"),e.innerHTML='<h3 class="svelte-1d5o944">Zones</h3> <div class="legend-item svelte-1d5o944"><div class="swatch res svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Residential (Green)</strong> <p class="svelte-1d5o944">Where people live. Darkens as population grows.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="swatch com svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Commercial (Blue)</strong> <p class="svelte-1d5o944">Shops and offices. Needs people and goods.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="swatch ind svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Industrial (Yellow)</strong> <p class="svelte-1d5o944">Factories. Creates jobs and goods.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="swatch park svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Park (Dark Green)</strong> <p class="svelte-1d5o944">Increases happiness of nearby residents.</p></div></div>',o=N(),n=v("section"),n.innerHTML='<h3 class="svelte-1d5o944">Traffic Indicators</h3> <p class="section-desc svelte-1d5o944">Moving dots on roads indicate traffic flow.</p> <div class="legend-item svelte-1d5o944"><div class="traffic-swatch svelte-1d5o944"><div class="dot green svelte-1d5o944"></div></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Green Dot</strong> <p class="svelte-1d5o944">Light traffic. Free flowing.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="traffic-swatch svelte-1d5o944"><div class="dot amber svelte-1d5o944"></div></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Amber Dot</strong> <p class="svelte-1d5o944">Moderate traffic.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="traffic-swatch svelte-1d5o944"><div class="dot red svelte-1d5o944"></div></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Red Dot</strong> <p class="svelte-1d5o944">Heavy traffic. Congestion may slow growth.</p></div></div>'},m(s,i){H(s,e,i),H(s,o,i),H(s,n,i)},p:J,d(s){s&&(G(e),G(o),G(n))}}}function Pt(t){let e,o,n=t[10].name+"",s,i,r,l=t[10].home+"",a,c,f,h=(t[10].work||"-")+"",m,w,d,T=t[10].left?"Left":"Active",$,L,g,D=(t[10].daysMissed||0)+"",y,F,q,C=(t[10].unemployedDays||0)+"",p,A;return{c(){e=v("tr"),o=v("td"),s=U(n),i=N(),r=v("td"),a=U(l),c=N(),f=v("td"),m=U(h),w=N(),d=v("td"),$=U(T),L=N(),g=v("td"),y=U(D),F=N(),q=v("td"),p=U(C),A=N(),M(o,"class","svelte-1d5o944"),M(r,"class","svelte-1d5o944"),M(f,"class","svelte-1d5o944"),M(d,"class","svelte-1d5o944"),M(g,"class","svelte-1d5o944"),M(q,"class","svelte-1d5o944"),M(e,"class","svelte-1d5o944"),ge(e,"left",t[10].left)},m(j,_){H(j,e,_),u(e,o),u(o,s),u(e,i),u(e,r),u(r,a),u(e,c),u(e,f),u(f,m),u(e,w),u(e,d),u(d,$),u(e,L),u(e,g),u(g,y),u(e,F),u(e,q),u(q,p),u(e,A)},p(j,_){_&8&&n!==(n=j[10].name+"")&&ne(s,n),_&8&&l!==(l=j[10].home+"")&&ne(a,l),_&8&&h!==(h=(j[10].work||"-")+"")&&ne(m,h),_&8&&T!==(T=j[10].left?"Left":"Active")&&ne($,T),_&8&&D!==(D=(j[10].daysMissed||0)+"")&&ne(y,D),_&8&&C!==(C=(j[10].unemployedDays||0)+"")&&ne(p,C),_&8&&ge(e,"left",j[10].left)},d(j){j&&G(e)}}}function mn(t){let e,o,n,s,i,r,l,a,c,f,h,m,w,d,T;function $(D,y){return D[2]?pn:yn}let L=$(t),g=L(t);return{c(){e=v("div"),o=v("div"),n=v("button"),n.textContent="Ã—",s=N(),i=v("h2"),i.textContent="Legend & Help",r=N(),l=v("div"),a=v("button"),a.textContent="Legend",c=N(),f=v("button"),f.textContent="Debug Tools",h=N(),g.c(),m=N(),w=v("div"),w.textContent="v0.0.0",M(n,"class","close-btn svelte-1d5o944"),M(i,"class","svelte-1d5o944"),M(a,"class","svelte-1d5o944"),ge(a,"active",!t[2]),M(f,"class","svelte-1d5o944"),ge(f,"active",t[2]),M(l,"class","tabs svelte-1d5o944"),M(w,"class","version svelte-1d5o944"),M(o,"class","modal-content svelte-1d5o944"),M(e,"class","modal-backdrop svelte-1d5o944")},m(D,y){H(D,e,y),u(e,o),u(o,n),u(o,s),u(o,i),u(o,r),u(o,l),u(l,a),u(l,c),u(l,f),u(o,h),g.m(o,null),u(o,m),u(o,w),d||(T=[re(n,"click",t[4]),re(a,"click",t[6]),re(f,"click",t[7]),re(o,"click",yo(t[5])),re(e,"click",t[4])],d=!0)},p(D,[y]){y&4&&ge(a,"active",!D[2]),y&4&&ge(f,"active",D[2]),L===(L=$(D))&&g?g.p(D,y):(g.d(1),g=L(D),g&&(g.c(),g.m(o,m)))},i:J,o:J,d(D){D&&G(e),g.d(),d=!1,ve(T)}}}const qt=t=>!t.left,zt=t=>!t.left&&t.work;function gn(t,e,o){let n,s;Me(t,ye,w=>o(1,s=w));const i=Ro();let r=!1,l="";function a(){i("close")}function c(w){go.call(this,t,w)}const f=()=>o(2,r=!1),h=()=>o(2,r=!0);function m(){l=this.value,o(0,l)}return t.$$.update=()=>{t.$$.dirty&3&&o(3,n=s.filter(w=>{if(!l)return!0;const d=l.toLowerCase();return w.name.toLowerCase().includes(d)||w.home.toLowerCase().includes(d)||w.work&&w.work.toLowerCase().includes(d)}))},[l,s,r,n,a,c,f,h,m]}class vn extends Ee{constructor(e){super(),De(this,e,gn,mn,Te,{})}}function Wt(t){let e,o;return e=new vn({}),e.$on("close",t[6]),{c(){Ne(e.$$.fragment)},m(n,s){$e(e,n,s),o=!0},p:J,i(n){o||(se(e.$$.fragment,n),o=!0)},o(n){ue(e.$$.fragment,n),o=!1},d(n){Se(e,n)}}}function Mn(t){let e,o,n,s,i,r,l,a,c,f,h,m,w,d,T,$,L,g,D,y,F,q,C,p,A,j,_,K,x,S,k,Z,P,te,W,Y,b,I,R,z,E,X,V,ee,Q,ie,fe,Ie,le=t[0]&&Wt(t);return{c(){e=v("header"),o=v("div"),n=v("span"),n.textContent="Money",s=N(),i=v("span"),r=U("$"),l=U(t[1]),a=N(),c=v("div"),f=v("span"),f.textContent="Population",h=N(),m=v("span"),w=U(t[2]),d=N(),T=v("div"),$=v("span"),$.textContent="Day",L=N(),g=v("span"),D=U(t[3]),y=N(),F=v("div"),q=v("div"),q.textContent="RCI",C=N(),p=v("div"),A=v("div"),j=v("div"),_=v("div"),K=N(),x=v("span"),x.textContent="R",S=N(),k=v("div"),Z=v("div"),P=v("div"),te=N(),W=v("span"),W.textContent="C",Y=N(),b=v("div"),I=v("div"),R=v("div"),z=N(),E=v("span"),E.textContent="I",X=N(),V=v("button"),V.textContent="?",ee=N(),le&&le.c(),Q=vt(),M(n,"class","label svelte-1ylazd0"),M(i,"class","value svelte-1ylazd0"),M(o,"class","stat svelte-1ylazd0"),M(f,"class","label svelte-1ylazd0"),M(m,"class","value svelte-1ylazd0"),M(c,"class","stat svelte-1ylazd0"),M($,"class","label svelte-1ylazd0"),M(g,"class","value svelte-1ylazd0"),M(T,"class","stat svelte-1ylazd0"),M(q,"class","rci-label svelte-1ylazd0"),M(_,"class","bar res svelte-1ylazd0"),pe(_,"height",Math.max(5,Math.min(100,t[4].residential))+"%"),M(j,"class","bar-track svelte-1ylazd0"),M(x,"class","bar-label svelte-1ylazd0"),M(A,"class","bar-group svelte-1ylazd0"),M(P,"class","bar com svelte-1ylazd0"),pe(P,"height",Math.max(5,Math.min(100,t[4].commercial))+"%"),M(Z,"class","bar-track svelte-1ylazd0"),M(W,"class","bar-label svelte-1ylazd0"),M(k,"class","bar-group svelte-1ylazd0"),M(R,"class","bar ind svelte-1ylazd0"),pe(R,"height",Math.max(5,Math.min(100,t[4].industrial))+"%"),M(I,"class","bar-track svelte-1ylazd0"),M(E,"class","bar-label svelte-1ylazd0"),M(b,"class","bar-group svelte-1ylazd0"),M(p,"class","bars svelte-1ylazd0"),M(F,"class","rci-container svelte-1ylazd0"),M(V,"class","help-btn svelte-1ylazd0"),M(V,"title","Legend & Help"),M(e,"class","svelte-1ylazd0")},m(ae,de){H(ae,e,de),u(e,o),u(o,n),u(o,s),u(o,i),u(i,r),u(i,l),u(e,a),u(e,c),u(c,f),u(c,h),u(c,m),u(m,w),u(e,d),u(e,T),u(T,$),u(T,L),u(T,g),u(g,D),u(e,y),u(e,F),u(F,q),u(F,C),u(F,p),u(p,A),u(A,j),u(j,_),u(A,K),u(A,x),u(p,S),u(p,k),u(k,Z),u(Z,P),u(k,te),u(k,W),u(p,Y),u(p,b),u(b,I),u(I,R),u(b,z),u(b,E),u(e,X),u(e,V),H(ae,ee,de),le&&le.m(ae,de),H(ae,Q,de),ie=!0,fe||(Ie=re(V,"click",t[5]),fe=!0)},p(ae,[de]){(!ie||de&2)&&ne(l,ae[1]),(!ie||de&4)&&ne(w,ae[2]),(!ie||de&8)&&ne(D,ae[3]),(!ie||de&16)&&pe(_,"height",Math.max(5,Math.min(100,ae[4].residential))+"%"),(!ie||de&16)&&pe(P,"height",Math.max(5,Math.min(100,ae[4].commercial))+"%"),(!ie||de&16)&&pe(R,"height",Math.max(5,Math.min(100,ae[4].industrial))+"%"),ae[0]?le?(le.p(ae,de),de&1&&se(le,1)):(le=Wt(ae),le.c(),se(le,1),le.m(Q.parentNode,Q)):le&&(qe(),ue(le,1,1,()=>{le=null}),ze())},i(ae){ie||(se(le),ie=!0)},o(ae){ue(le),ie=!1},d(ae){ae&&(G(e),G(ee),G(Q)),le&&le.d(ae),fe=!1,Ie()}}}function _n(t,e,o){let n,s,i,r;Me(t,ot,f=>o(1,n=f)),Me(t,He,f=>o(2,s=f)),Me(t,me,f=>o(3,i=f)),Me(t,Mo,f=>o(4,r=f));let l=!1;return[l,n,s,i,r,()=>o(0,l=!0),()=>o(0,l=!1)]}class bn extends Ee{constructor(e){super(),De(this,e,_n,Mn,Te,{})}}function Gt(t,e,o){const n=t.slice();return n[3]=e[o],n}function wn(t){let e;return{c(){e=v("span"),e.textContent=`$${tt[t[3].id]}`,M(e,"class","cost svelte-omakiu")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Ut(t){let e,o,n,s,i,r,l=tt[t[3].id]&&wn(t);function a(){return t[2](t[3])}return{c(){e=v("button"),o=v("span"),o.textContent=`${t[3].label}`,n=N(),l&&l.c(),s=N(),M(o,"class","label svelte-omakiu"),pe(e,"--color",t[3].color),M(e,"class","svelte-omakiu"),ge(e,"active",t[0]===t[3].id)},m(c,f){H(c,e,f),u(e,o),u(e,n),l&&l.m(e,null),u(e,s),i||(r=re(e,"click",a),i=!0)},p(c,f){t=c,tt[t[3].id]&&l.p(t,f),f&3&&ge(e,"active",t[0]===t[3].id)},d(c){c&&G(e),l&&l.d(),i=!1,r()}}}function kn(t){let e,o=ce(t[1]),n=[];for(let s=0;s<o.length;s+=1)n[s]=Ut(Gt(t,o,s));return{c(){e=v("div");for(let s=0;s<n.length;s+=1)n[s].c();M(e,"class","toolbar svelte-omakiu")},m(s,i){H(s,e,i);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(s,[i]){if(i&3){o=ce(s[1]);let r;for(r=0;r<o.length;r+=1){const l=Gt(s,o,r);n[r]?n[r].p(l,i):(n[r]=Ut(l),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=o.length}},i:J,o:J,d(s){s&&G(e),Ce(n,s)}}}function In(t,e,o){let n;Me(t,ft,r=>o(0,n=r));const s=[{id:O.RESIDENTIAL,label:"Res",color:"#4ade80"},{id:O.COMMERCIAL,label:"Com",color:"#60a5fa"},{id:O.INDUSTRIAL,label:"Ind",color:"#facc15"},{id:O.ROAD,label:"Road",color:"#4b5563"},{id:O.PARK,label:"Park",color:"#15803d"},{id:O.EMPTY,label:"Bulldoze",color:"#ef4444"}];return[n,s,r=>ft.set(r.id)]}class Cn extends Ee{constructor(e){super(),De(this,e,In,kn,Te,{})}}function An(t){let e;function o(i,r){return i[0].traffic>0?Sn:$n}let n=o(t),s=n(t);return{c(){s.c(),e=vt()},m(i,r){s.m(i,r),H(i,e,r)},p(i,r){n===(n=o(i))&&s?s.p(i,r):(s.d(1),s=n(i),s&&(s.c(),s.m(e.parentNode,e)))},d(i){i&&G(e),s.d(i)}}}function Tn(t){let e,o=t[0].population+"",n;return{c(){e=v("span"),n=U(o),M(e,"class","pop svelte-194cfaq")},m(s,i){H(s,e,i),u(e,n)},p(s,i){i&1&&o!==(o=s[0].population+"")&&ne(n,o)},d(s){s&&G(e)}}}function $n(t){let e;return{c(){e=v("span"),e.textContent="â€¢",M(e,"class","road-mark svelte-194cfaq")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Sn(t){let e,o;return{c(){e=v("div"),o=v("div"),M(o,"class","car svelte-194cfaq"),pe(o,"background-color",Ht(t[0].traffic)),M(e,"class","traffic-container svelte-194cfaq"),pe(e,"animation-duration",3/(1+t[0].traffic*.1)+"s")},m(n,s){H(n,e,s),u(e,o)},p(n,s){s&1&&pe(o,"background-color",Ht(n[0].traffic)),s&1&&pe(e,"animation-duration",3/(1+n[0].traffic*.1)+"s")},d(n){n&&G(e)}}}function xn(t){let e,o,n;function s(l,a){if(l[0].population>0)return Tn;if(l[0].type==="road")return An}let i=s(t),r=i&&i(t);return{c(){e=v("div"),r&&r.c(),M(e,"class","tile svelte-194cfaq"),pe(e,"background-color",t[1]),M(e,"role","button")},m(l,a){H(l,e,a),r&&r.m(e,null),o||(n=re(e,"click",t[2]),o=!0)},p(l,[a]){i===(i=s(l))&&r?r.p(l,a):(r&&r.d(1),r=i&&i(l),r&&(r.c(),r.m(e,null))),a&2&&pe(e,"background-color",l[1])},i:J,o:J,d(l){l&&G(e),r&&r.d(),o=!1,n()}}}function Dn(t,e){let o;switch(t){case"residential":o=[74,222,128];break;case"commercial":o=[96,165,250];break;case"industrial":o=[250,204,21];break;case"road":return"#4b5563";case"park":return"#14532d";default:return"#f3f4f6"}const i=1-Math.min(1,e/(t==="residential"?50:25))*.4;return`rgb(${Math.floor(o[0]*i)}, ${Math.floor(o[1]*i)}, ${Math.floor(o[2]*i)})`}function Ht(t){return t>5?"#ef4444":t>2?"#fbbf24":"#4ade80"}function En(t,e,o){let n,s;Me(t,ft,c=>o(5,s=c));let{x:i}=e,{y:r}=e,{tile:l}=e;function a(){hn(i,r,s)}return t.$$set=c=>{"x"in c&&o(3,i=c.x),"y"in c&&o(4,r=c.y),"tile"in c&&o(0,l=c.tile)},t.$$.update=()=>{t.$$.dirty&1&&o(1,n=Dn(l.type,l.population))},[l,n,a,i,r]}class jn extends Ee{constructor(e){super(),De(this,e,En,xn,Te,{x:3,y:4,tile:0})}}function Ft(t,e,o){const n=t.slice();return n[3]=e[o],n[5]=o,n}function Bt(t,e,o){const n=t.slice();return n[6]=e[o],n[8]=o,n}function Yt(t,e,o){const n=t.slice();return n[3]=e[o],n}function Kt(t,e,o){const n=t.slice();return n[11]=e[o],n}function Jt(t){let e;return{c(){e=v("div"),e.textContent=`${t[11]}`,M(e,"class","col-label svelte-1sqmj97")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Zt(t){let e;return{c(){e=v("div"),e.textContent=`${t[3]}`,M(e,"class","row-label svelte-1sqmj97")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Vt(t){let e,o;return e=new jn({props:{x:t[8],y:t[5],tile:t[6]}}),{c(){Ne(e.$$.fragment)},m(n,s){$e(e,n,s),o=!0},p(n,s){const i={};s&1&&(i.tile=n[6]),e.$set(i)},i(n){o||(se(e.$$.fragment,n),o=!0)},o(n){ue(e.$$.fragment,n),o=!1},d(n){Se(e,n)}}}function Qt(t){let e,o,n,s=ce(t[3]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Vt(Bt(t,s,l));const r=l=>ue(i[l],1,1,()=>{i[l]=null});return{c(){e=v("div");for(let l=0;l<i.length;l+=1)i[l].c();o=N(),M(e,"class","row svelte-1sqmj97")},m(l,a){H(l,e,a);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);u(e,o),n=!0},p(l,a){if(a&1){s=ce(l[3]);let c;for(c=0;c<s.length;c+=1){const f=Bt(l,s,c);i[c]?(i[c].p(f,a),se(i[c],1)):(i[c]=Vt(f),i[c].c(),se(i[c],1),i[c].m(e,o))}for(qe(),c=s.length;c<i.length;c+=1)r(c);ze()}},i(l){if(!n){for(let a=0;a<s.length;a+=1)se(i[a]);n=!0}},o(l){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)ue(i[a]);n=!1},d(l){l&&G(e),Ce(i,l)}}}function Rn(t){let e,o,n,s,i,r,l,a,c,f,h=ce(t[1]),m=[];for(let g=0;g<h.length;g+=1)m[g]=Jt(Kt(t,h,g));let w=ce(t[2]),d=[];for(let g=0;g<w.length;g+=1)d[g]=Zt(Yt(t,w,g));let T=ce(t[0]),$=[];for(let g=0;g<T.length;g+=1)$[g]=Qt(Ft(t,T,g));const L=g=>ue($[g],1,1,()=>{$[g]=null});return{c(){e=v("div"),o=v("div"),n=v("div"),s=N();for(let g=0;g<m.length;g+=1)m[g].c();i=N(),r=v("div"),l=v("div");for(let g=0;g<d.length;g+=1)d[g].c();a=N(),c=v("div");for(let g=0;g<$.length;g+=1)$[g].c();M(n,"class","corner svelte-1sqmj97"),M(o,"class","header-row svelte-1sqmj97"),M(l,"class","row-labels svelte-1sqmj97"),M(c,"class","grid-container svelte-1sqmj97"),M(r,"class","main-area svelte-1sqmj97"),M(e,"class","layout svelte-1sqmj97")},m(g,D){H(g,e,D),u(e,o),u(o,n),u(o,s);for(let y=0;y<m.length;y+=1)m[y]&&m[y].m(o,null);u(e,i),u(e,r),u(r,l);for(let y=0;y<d.length;y+=1)d[y]&&d[y].m(l,null);u(r,a),u(r,c);for(let y=0;y<$.length;y+=1)$[y]&&$[y].m(c,null);f=!0},p(g,[D]){if(D&2){h=ce(g[1]);let y;for(y=0;y<h.length;y+=1){const F=Kt(g,h,y);m[y]?m[y].p(F,D):(m[y]=Jt(F),m[y].c(),m[y].m(o,null))}for(;y<m.length;y+=1)m[y].d(1);m.length=h.length}if(D&4){w=ce(g[2]);let y;for(y=0;y<w.length;y+=1){const F=Yt(g,w,y);d[y]?d[y].p(F,D):(d[y]=Zt(F),d[y].c(),d[y].m(l,null))}for(;y<d.length;y+=1)d[y].d(1);d.length=w.length}if(D&1){T=ce(g[0]);let y;for(y=0;y<T.length;y+=1){const F=Ft(g,T,y);$[y]?($[y].p(F,D),se($[y],1)):($[y]=Qt(F),$[y].c(),se($[y],1),$[y].m(c,null))}for(qe(),y=T.length;y<$.length;y+=1)L(y);ze()}},i(g){if(!f){for(let D=0;D<T.length;D+=1)se($[D]);f=!0}},o(g){$=$.filter(Boolean);for(let D=0;D<$.length;D+=1)ue($[D]);f=!1},d(g){g&&G(e),Ce(m,g),Ce(d,g),Ce($,g)}}}function Ln(t,e,o){let n;Me(t,be,r=>o(0,n=r));const s=Array.from({length:20},(r,l)=>l+1),i=Array.from({length:20},(r,l)=>String.fromCharCode(65+l));return[n,s,i]}class Nn extends Ee{constructor(e){super(),De(this,e,Ln,Rn,Te,{})}}function On(t){const e=t-1;return e*e*e+1}function pt(t,{delay:e=0,duration:o=400,easing:n=it}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:o,easing:n,css:i=>`opacity: ${i*s}`}}function Pn(t,{delay:e=0,duration:o=400,easing:n=On,x:s=0,y:i=0,opacity:r=0}={}){const l=getComputedStyle(t),a=+l.opacity,c=l.transform==="none"?"":l.transform,f=a*(1-r),[h,m]=Ct(s),[w,d]=Ct(i);return{delay:e,duration:o,easing:n,css:(T,$)=>`
			transform: ${c} translate(${(1-T)*h}${m}, ${(1-T)*w}${d});
			opacity: ${a-f*$}`}}function Xt(t,e,o){const n=t.slice();return n[24]=e[o],n}function eo(t,e,o){const n=t.slice();return n[27]=e[o],n}function to(t,e,o){const n=t.slice();return n[30]=e[o],n[32]=o,n}function oo(t){let e,o=ce(t[4]),n=[];for(let s=0;s<o.length;s+=1)n[s]=no(to(t,o,s));return{c(){e=v("ul");for(let s=0;s<n.length;s+=1)n[s].c();M(e,"class","autocomplete-list svelte-1itj0d0")},m(s,i){H(s,e,i);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(s,i){if(i[0]&560){o=ce(s[4]);let r;for(r=0;r<o.length;r+=1){const l=to(s,o,r);n[r]?n[r].p(l,i):(n[r]=no(l),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=o.length}},d(s){s&&G(e),Ce(n,s)}}}function no(t){let e,o,n=t[30]+"",s,i,r,l;function a(){return t[19](t[30])}function c(){return t[20](t[32])}return{c(){e=v("li"),o=U("@"),s=U(n),i=N(),M(e,"class","svelte-1itj0d0"),ge(e,"selected",t[32]===t[5])},m(f,h){H(f,e,h),u(e,o),u(e,s),u(e,i),r||(l=[re(e,"click",a),re(e,"mouseenter",c)],r=!0)},p(f,h){t=f,h[0]&16&&n!==(n=t[30]+"")&&ne(s,n),h[0]&32&&ge(e,"selected",t[32]===t[5])},d(f){f&&G(e),r=!1,ve(l)}}}function qn(t){let e;return{c(){e=v("div"),e.innerHTML="<p>No one lives here yet...</p>",M(e,"class","empty-state svelte-1itj0d0")},m(o,n){H(o,e,n)},p:J,i:J,o:J,d(o){o&&G(e)}}}function zn(t){let e=[],o=new Map,n,s,i=ce(t[0]);const r=l=>l[27].id;for(let l=0;l<i.length;l+=1){let a=eo(t,i,l),c=r(a);o.set(c,e[l]=so(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();n=vt()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);H(l,n,a),s=!0},p(l,a){a[0]&4097&&(i=ce(l[0]),qe(),e=Go(e,a,r,1,l,i,o,n.parentNode,Wo,so,n,eo),ze())},i(l){if(!s){for(let a=0;a<i.length;a+=1)se(e[a]);s=!0}},o(l){for(let a=0;a<e.length;a+=1)ue(e[a]);s=!1},d(l){l&&G(n);for(let a=0;a<e.length;a+=1)e[a].d(l)}}}function so(t,e){let o,n,s,i=e[27].author.name+"",r,l,a,c=e[27].text+"",f,h,m,w=e[27].time+"",d,T,$,L,g,D,y;function F(){return e[21](e[27])}return{key:t,first:null,c(){o=v("div"),n=v("div"),s=U("@"),r=U(i),l=N(),a=v("div"),f=U(c),h=N(),m=v("div"),d=U(w),T=N(),M(n,"class","author svelte-1itj0d0"),ge(n,"clickable",!e[27].author.isSystem),M(a,"class","content svelte-1itj0d0"),M(m,"class","time svelte-1itj0d0"),M(o,"class","tweet svelte-1itj0d0"),this.first=o},m(q,C){H(q,o,C),u(o,n),u(n,s),u(n,r),u(o,l),u(o,a),u(a,f),u(o,h),u(o,m),u(m,d),u(o,T),g=!0,D||(y=re(n,"click",F),D=!0)},p(q,C){e=q,(!g||C[0]&1)&&i!==(i=e[27].author.name+"")&&ne(r,i),(!g||C[0]&1)&&ge(n,"clickable",!e[27].author.isSystem),(!g||C[0]&1)&&c!==(c=e[27].text+"")&&ne(f,c),(!g||C[0]&1)&&w!==(w=e[27].time+"")&&ne(d,w)},i(q){g||(q&&Ae(()=>{g&&(L&&L.end(1),$=qo(o,Pn,{y:20,duration:300}),$.start())}),g=!0)},o(q){$&&$.invalidate(),q&&(L=zo(o,pt,{})),g=!1},d(q){q&&G(o),q&&L&&L.end(),D=!1,y()}}}function io(t){let e,o,n,s,i=t[2].name+"",r,l,a,c,f,h,m,w,d,T=t[2].home+"",$,L,g,D,y,F,q,C=t[2].since+"",p,A,j=t[2].left?`${t[2].left}`:"Now",_,K,x,S,k,Z,P=t[2].work&&lo(t),te=t[2].history&&t[2].history.length>0&&ro(t);return{c(){e=v("div"),o=v("div"),n=v("div"),s=v("h4"),r=U(i),l=N(),a=v("button"),a.textContent="Ã—",c=N(),f=v("div"),h=v("div"),m=v("span"),m.textContent="Home:",w=N(),d=v("span"),$=U(T),L=N(),P&&P.c(),g=N(),D=v("div"),y=v("span"),y.textContent="Resident:",F=N(),q=v("span"),p=U(C),A=U(" â†’ "),_=U(j),K=N(),te&&te.c(),M(s,"class","svelte-1itj0d0"),M(a,"class","close-btn svelte-1itj0d0"),M(n,"class","modal-header svelte-1itj0d0"),M(m,"class","label svelte-1itj0d0"),M(d,"class","value svelte-1itj0d0"),M(h,"class","detail-row svelte-1itj0d0"),M(y,"class","label svelte-1itj0d0"),M(q,"class","value svelte-1itj0d0"),M(D,"class","detail-row svelte-1itj0d0"),M(f,"class","profile-details svelte-1itj0d0"),M(o,"class","modal svelte-1itj0d0"),M(e,"class","modal-backdrop svelte-1itj0d0")},m(W,Y){H(W,e,Y),u(e,o),u(o,n),u(n,s),u(s,r),u(n,l),u(n,a),u(o,c),u(o,f),u(f,h),u(h,m),u(h,w),u(h,d),u(d,$),u(f,L),P&&P.m(f,null),u(f,g),u(f,D),u(D,y),u(D,F),u(D,q),u(q,p),u(q,A),u(q,_),u(f,K),te&&te.m(f,null),S=!0,k||(Z=[re(a,"click",t[13]),re(o,"click",yo(t[16])),re(e,"click",t[13])],k=!0)},p(W,Y){(!S||Y[0]&4)&&i!==(i=W[2].name+"")&&ne(r,i),(!S||Y[0]&4)&&T!==(T=W[2].home+"")&&ne($,T),W[2].work?P?P.p(W,Y):(P=lo(W),P.c(),P.m(f,g)):P&&(P.d(1),P=null),(!S||Y[0]&4)&&C!==(C=W[2].since+"")&&ne(p,C),(!S||Y[0]&4)&&j!==(j=W[2].left?`${W[2].left}`:"Now")&&ne(_,j),W[2].history&&W[2].history.length>0?te?te.p(W,Y):(te=ro(W),te.c(),te.m(f,null)):te&&(te.d(1),te=null)},i(W){S||(W&&Ae(()=>{S&&(x||(x=Tt(e,pt,{},!0)),x.run(1))}),S=!0)},o(W){W&&(x||(x=Tt(e,pt,{},!1)),x.run(0)),S=!1},d(W){W&&G(e),P&&P.d(),te&&te.d(),W&&x&&x.end(),k=!1,ve(Z)}}}function lo(t){let e,o,n,s,i=t[2].work+"",r;return{c(){e=v("div"),o=v("span"),o.textContent="Work:",n=N(),s=v("span"),r=U(i),M(o,"class","label svelte-1itj0d0"),M(s,"class","value svelte-1itj0d0"),M(e,"class","detail-row svelte-1itj0d0")},m(l,a){H(l,e,a),u(e,o),u(e,n),u(e,s),u(s,r)},p(l,a){a[0]&4&&i!==(i=l[2].work+"")&&ne(r,i)},d(l){l&&G(e)}}}function ro(t){let e,o,n,s,i=ce(t[2].history),r=[];for(let l=0;l<i.length;l+=1)r[l]=ao(Xt(t,i,l));return{c(){e=v("div"),o=v("span"),o.textContent="History",n=N(),s=v("ul");for(let l=0;l<r.length;l+=1)r[l].c();M(o,"class","label svelte-1itj0d0"),M(s,"class","history-list svelte-1itj0d0"),M(e,"class","history-section svelte-1itj0d0")},m(l,a){H(l,e,a),u(e,o),u(e,n),u(e,s);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,null)},p(l,a){if(a[0]&4){i=ce(l[2].history);let c;for(c=0;c<i.length;c+=1){const f=Xt(l,i,c);r[c]?r[c].p(f,a):(r[c]=ao(f),r[c].c(),r[c].m(s,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=i.length}},d(l){l&&G(e),Ce(r,l)}}}function Wn(t){let e;return{c(){e=U("Left the city")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Gn(t){let e;return{c(){e=U("Moved in (correction)")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Un(t){let e;return{c(){e=U("Evicted (zone demolished)")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Hn(t){let e;return{c(){e=U("Evicted (overcrowding)")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Fn(t){let e;return{c(){e=U("Lost job (workplace closed)")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Bn(t){let e;return{c(){e=U("Laid off (downsizing)")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Yn(t){let e;return{c(){e=U("Lost job (fired for absence)")},m(o,n){H(o,e,n)},p:J,d(o){o&&G(e)}}}function Kn(t){let e,o=t[24].work+"",n;return{c(){e=U("Started job at "),n=U(o)},m(s,i){H(s,e,i),H(s,n,i)},p(s,i){i[0]&4&&o!==(o=s[24].work+"")&&ne(n,o)},d(s){s&&(G(e),G(n))}}}function Jn(t){let e,o=t[24].from+"",n,s,i=t[24].to+"",r;return{c(){e=U("Moved "),n=U(o),s=U(" â†’ "),r=U(i)},m(l,a){H(l,e,a),H(l,n,a),H(l,s,a),H(l,r,a)},p(l,a){a[0]&4&&o!==(o=l[24].from+"")&&ne(n,o),a[0]&4&&i!==(i=l[24].to+"")&&ne(r,i)},d(l){l&&(G(e),G(n),G(s),G(r))}}}function Zn(t){let e,o=t[24].home+"",n;return{c(){e=U("Moved into "),n=U(o)},m(s,i){H(s,e,i),H(s,n,i)},p(s,i){i[0]&4&&o!==(o=s[24].home+"")&&ne(n,o)},d(s){s&&(G(e),G(n))}}}function ao(t){let e,o,n=t[24].time+"",s,i,r,l;function a(h,m){if(h[24].type==="move_in")return Zn;if(h[24].type==="move")return Jn;if(h[24].type==="new_job")return Kn;if(h[24].type==="fired")return Yn;if(h[24].type==="fired_excess")return Bn;if(h[24].type==="workplace_demolished")return Fn;if(h[24].type==="evicted")return Hn;if(h[24].type==="evicted_bulldoze")return Un;if(h[24].type==="drift_correction_spawn")return Gn;if(h[24].type==="left_city")return Wn}let c=a(t),f=c&&c(t);return{c(){e=v("li"),o=v("span"),s=U(n),i=N(),r=v("span"),f&&f.c(),l=N(),M(o,"class","history-time svelte-1itj0d0"),M(r,"class","history-desc"),M(e,"class","svelte-1itj0d0")},m(h,m){H(h,e,m),u(e,o),u(o,s),u(e,i),u(e,r),f&&f.m(r,null),u(e,l)},p(h,m){m[0]&4&&n!==(n=h[24].time+"")&&ne(s,n),c===(c=a(h))&&f?f.p(h,m):(f&&f.d(1),f=c&&c(h),f&&(f.c(),f.m(r,null)))},d(h){h&&G(e),f&&f.d()}}}function Vn(t){let e,o,n,s,i,r,l,a,c,f,h,m,w,d,T,$,L,g,D,y=t[3]&&t[4].length>0&&oo(t);const F=[zn,qn],q=[];function C(A,j){return A[7]>0?0:1}d=C(t),T=q[d]=F[d](t);let p=t[2]&&io(t);return{c(){e=v("div"),o=v("h3"),o.textContent="SimTwitty Feed",n=N(),s=v("div"),i=v("textarea"),r=N(),y&&y.c(),l=N(),a=v("div"),c=v("button"),f=U("Twit 'em"),m=N(),w=v("div"),T.c(),$=N(),p&&p.c(),M(o,"class","svelte-1itj0d0"),M(i,"placeholder","What's happening in the city, Mayor?"),M(i,"class","svelte-1itj0d0"),c.disabled=h=!t[1].trim(),M(c,"class","svelte-1itj0d0"),M(a,"class","tweet-actions svelte-1itj0d0"),M(s,"class","tweet-input svelte-1itj0d0"),M(w,"class","messages-container svelte-1itj0d0"),M(e,"class","feed svelte-1itj0d0")},m(A,j){H(A,e,j),u(e,o),u(e,n),u(e,s),u(s,i),t[17](i),Ze(i,t[1]),u(s,r),y&&y.m(s,null),u(s,l),u(s,a),u(a,c),u(c,f),u(e,m),u(e,w),q[d].m(w,null),u(e,$),p&&p.m(e,null),L=!0,g||(D=[re(i,"input",t[18]),re(i,"keydown",t[11]),re(i,"input",t[8]),re(i,"click",t[8]),re(c,"click",t[10])],g=!0)},p(A,j){j[0]&2&&Ze(i,A[1]),A[3]&&A[4].length>0?y?y.p(A,j):(y=oo(A),y.c(),y.m(s,l)):y&&(y.d(1),y=null),(!L||j[0]&2&&h!==(h=!A[1].trim()))&&(c.disabled=h);let _=d;d=C(A),d===_?q[d].p(A,j):(qe(),ue(q[_],1,1,()=>{q[_]=null}),ze(),T=q[d],T?T.p(A,j):(T=q[d]=F[d](A),T.c()),se(T,1),T.m(w,null)),A[2]?p?(p.p(A,j),j[0]&4&&se(p,1)):(p=io(A),p.c(),se(p,1),p.m(e,null)):p&&(qe(),ue(p,1,1,()=>{p=null}),ze())},i(A){L||(se(T),se(p),L=!0)},o(A){ue(T),ue(p),L=!1},d(A){A&&G(e),t[17](null),y&&y.d(),q[d].d(),p&&p.d(),g=!1,ve(D)}}}function Qn(t,e,o){let n,s,i;Me(t,ye,_=>o(22,n=_)),Me(t,_o,_=>o(0,s=_)),Me(t,He,_=>o(7,i=_));let r="",l=null,a=[],c=!1,f="",h=[],m=0,w;function d(_){T(_.target)}function T(_){const K=_.selectionStart,x=_.value,S=x.lastIndexOf("@",K-1);if(S!==-1){const k=x.slice(S+1,K);if(!k.includes(" ")){o(3,c=!0),o(15,f=k),o(5,m=0);return}}o(3,c=!1),o(15,f="")}function $(_){if(!w)return;const K=w.selectionStart,x=r,S=x.lastIndexOf("@",K-1);if(S!==-1){const k=x.slice(0,S),Z=x.slice(K);o(1,r=`${k}@${_} ${Z}`),o(3,c=!1),o(15,f=""),setTimeout(()=>{w.focus();const P=S+_.length+2;w.setSelectionRange(P,P)},0)}}function L(){if(r.trim()){we(r,{name:"Mayor",isSystem:!0});const _=cn(r);if(_){const K=n.find(x=>x.name.toLowerCase()===_.toLowerCase()&&!x.left);K&&an(K.name,r)}o(1,r="")}}function g(_){if(c&&h.length>0){if(_.key==="ArrowDown"){_.preventDefault(),o(5,m=(m+1)%h.length);return}if(_.key==="ArrowUp"){_.preventDefault(),o(5,m=(m-1+h.length)%h.length);return}if(_.key==="Enter"||_.key==="Tab"){_.preventDefault(),$(h[m]);return}if(_.key==="Escape"){_.preventDefault(),o(3,c=!1);return}}_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),L())}function D(_){_.isSystem||o(2,l=_)}function y(){o(2,l=null)}function F(_){go.call(this,t,_)}function q(_){ct[_?"unshift":"push"](()=>{w=_,o(6,w)})}function C(){r=this.value,o(1,r)}const p=_=>$(_),A=_=>o(5,m=_),j=_=>D(_.author);return t.$$.update=()=>{if(t.$$.dirty[0]&1){const _=new Set;s.forEach(K=>{K.author&&K.author.name&&_.add(K.author.name)}),o(14,a=Array.from(_).sort())}t.$$.dirty[0]&49152&&(f?o(4,h=a.filter(_=>_.toLowerCase().includes(f.toLowerCase())).slice(0,5)):o(4,h=a.slice(0,5)))},[s,r,l,c,h,m,w,i,d,$,L,g,D,y,a,f,F,q,C,p,A,j]}class Xn extends Ee{constructor(e){super(),De(this,e,Qn,Vn,Te,{},null,[-1,-1])}}function es(t){let e,o,n,s,i,r,l,a,c,f,h,m,w;return o=new bn({}),r=new Cn({}),c=new Nn({}),m=new Xn({}),{c(){e=v("div"),Ne(o.$$.fragment),n=N(),s=v("div"),i=v("main"),Ne(r.$$.fragment),l=N(),a=v("div"),Ne(c.$$.fragment),f=N(),h=v("aside"),Ne(m.$$.fragment),M(a,"class","game-board svelte-ui0l6c"),M(i,"class","svelte-ui0l6c"),M(h,"class","svelte-ui0l6c"),M(s,"class","content-wrapper svelte-ui0l6c"),M(e,"class","app-container svelte-ui0l6c")},m(d,T){H(d,e,T),$e(o,e,null),u(e,n),u(e,s),u(s,i),$e(r,i,null),u(i,l),u(i,a),$e(c,a,null),u(s,f),u(s,h),$e(m,h,null),w=!0},p:J,i(d){w||(se(o.$$.fragment,d),se(r.$$.fragment,d),se(c.$$.fragment,d),se(m.$$.fragment,d),w=!0)},o(d){ue(o.$$.fragment,d),ue(r.$$.fragment,d),ue(c.$$.fragment,d),ue(m.$$.fragment,d),w=!1},d(d){d&&G(e),Se(o),Se(r),Se(c),Se(m)}}}function ts(t){let e;return Eo(()=>{e=setInterval(()=>{un()},250)}),jo(()=>{e&&clearInterval(e)}),[]}class os extends Ee{constructor(e){super(),De(this,e,ts,es,Te,{})}}new os({target:document.getElementById("app")});
