var ko=Object.defineProperty;var Io=(t,e,o)=>e in t?ko(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var it=(t,e,o)=>Io(t,typeof e!="symbol"?e+"":e,o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=o(s);fetch(s.href,l)}})();function J(){}const lt=t=>t;function co(t){return t()}function It(){return Object.create(null)}function ve(t){t.forEach(co)}function Ye(t){return typeof t=="function"}function Te(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Co(t){return Object.keys(t).length===0}function uo(t,...e){if(t==null){for(const n of e)n(void 0);return J}const o=t.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}function oe(t){let e;return uo(t,o=>e=o)(),e}function Me(t,e,o){t.$$.on_destroy.push(uo(e,o))}function Ct(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const fo=typeof window<"u";let yt=fo?()=>window.performance.now():()=>Date.now(),mt=fo?t=>requestAnimationFrame(t):J;const Oe=new Set;function ho(t){Oe.forEach(e=>{e.c(t)||(Oe.delete(e),e.f())}),Oe.size!==0&&mt(ho)}function gt(t){let e;return Oe.size===0&&mt(ho),{promise:new Promise(o=>{Oe.add(e={c:t,f:o})}),abort(){Oe.delete(e)}}}function u(t,e){t.appendChild(e)}function po(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Ao(t){const e=g("style");return e.textContent="/* empty */",To(po(t),e),e.sheet}function To(t,e){return u(t.head||t,e),e.sheet}function U(t,e,o){t.insertBefore(e,o||null)}function G(t){t.parentNode&&t.parentNode.removeChild(t)}function Ce(t,e){for(let o=0;o<t.length;o+=1)t[o]&&t[o].d(e)}function g(t){return document.createElement(t)}function H(t){return document.createTextNode(t)}function N(){return H(" ")}function vt(){return H("")}function re(t,e,o,n){return t.addEventListener(e,o,n),()=>t.removeEventListener(e,o,n)}function yo(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function M(t,e,o){o==null?t.removeAttribute(e):t.getAttribute(e)!==o&&t.setAttribute(e,o)}function $o(t){return Array.from(t.childNodes)}function ne(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ze(t,e){t.value=e??""}function pe(t,e,o,n){o==null?t.style.removeProperty(e):t.style.setProperty(e,o,"")}function ge(t,e,o){t.classList.toggle(e,!!o)}function mo(t,e,{bubbles:o=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:o,cancelable:n})}const Ve=new Map;let Qe=0;function So(t){let e=5381,o=t.length;for(;o--;)e=(e<<5)-e^t.charCodeAt(o);return e>>>0}function xo(t,e){const o={stylesheet:Ao(e),rules:{}};return Ve.set(t,o),o}function Xe(t,e,o,n,s,l,r,i=0){const a=16.666/n;let c=`{
`;for(let w=0;w<=1;w+=a){const L=e+(o-e)*l(w);c+=w*100+`%{${r(L,1-L)}}
`}const f=c+`100% {${r(o,1-o)}}
}`,d=`__svelte_${So(f)}_${i}`,m=po(t),{stylesheet:I,rules:h}=Ve.get(m)||xo(m,t);h[d]||(h[d]=!0,I.insertRule(`@keyframes ${d} ${f}`,I.cssRules.length));const A=t.style.animation||"";return t.style.animation=`${A?`${A}, `:""}${d} ${n}ms linear ${s}ms 1 both`,Qe+=1,d}function et(t,e){const o=(t.style.animation||"").split(", "),n=o.filter(e?l=>l.indexOf(e)<0:l=>l.indexOf("__svelte")===-1),s=o.length-n.length;s&&(t.style.animation=n.join(", "),Qe-=s,Qe||Do())}function Do(){mt(()=>{Qe||(Ve.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&G(e)}),Ve.clear())})}let Fe;function He(t){Fe=t}function Mt(){if(!Fe)throw new Error("Function called outside component initialization");return Fe}function Eo(t){Mt().$$.on_mount.push(t)}function jo(t){Mt().$$.on_destroy.push(t)}function Lo(){const t=Mt();return(e,o,{cancelable:n=!1}={})=>{const s=t.$$.callbacks[e];if(s){const l=mo(e,o,{cancelable:n});return s.slice().forEach(r=>{r.call(t,l)}),!l.defaultPrevented}return!0}}function go(t,e){const o=t.$$.callbacks[e.type];o&&o.slice().forEach(n=>n.call(this,e))}const Re=[],ct=[];let Pe=[];const At=[],Ro=Promise.resolve();let ut=!1;function No(){ut||(ut=!0,Ro.then(vo))}function Ae(t){Pe.push(t)}const rt=new Set;let je=0;function vo(){if(je!==0)return;const t=Fe;do{try{for(;je<Re.length;){const e=Re[je];je++,He(e),Oo(e.$$)}}catch(e){throw Re.length=0,je=0,e}for(He(null),Re.length=0,je=0;ct.length;)ct.pop()();for(let e=0;e<Pe.length;e+=1){const o=Pe[e];rt.has(o)||(rt.add(o),o())}Pe.length=0}while(Re.length);for(;At.length;)At.pop()();ut=!1,rt.clear(),He(t)}function Oo(t){if(t.fragment!==null){t.update(),ve(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ae)}}function Po(t){const e=[],o=[];Pe.forEach(n=>t.indexOf(n)===-1?e.push(n):o.push(n)),o.forEach(n=>n()),Pe=e}let We;function _t(){return We||(We=Promise.resolve(),We.then(()=>{We=null})),We}function xe(t,e,o){t.dispatchEvent(mo(`${e?"intro":"outro"}${o}`))}const Je=new Set;let _e;function qe(){_e={r:0,c:[],p:_e}}function ze(){_e.r||ve(_e.c),_e=_e.p}function se(t,e){t&&t.i&&(Je.delete(t),t.i(e))}function ue(t,e,o,n){if(t&&t.o){if(Je.has(t))return;Je.add(t),_e.c.push(()=>{Je.delete(t),n&&(o&&t.d(1),n())}),t.o(e)}else n&&n()}const bt={duration:0};function qo(t,e,o){const n={direction:"in"};let s=e(t,o,n),l=!1,r,i,a=0;function c(){r&&et(t,r)}function f(){const{delay:m=0,duration:I=300,easing:h=lt,tick:A=J,css:w}=s||bt;w&&(r=Xe(t,0,1,I,m,h,w,a++)),A(0,1);const L=yt()+m,v=L+I;i&&i.abort(),l=!0,Ae(()=>xe(t,!0,"start")),i=gt(D=>{if(l){if(D>=v)return A(1,0),xe(t,!0,"end"),c(),l=!1;if(D>=L){const y=h((D-L)/I);A(y,1-y)}}return l})}let d=!1;return{start(){d||(d=!0,et(t),Ye(s)?(s=s(n),_t().then(f)):f())},invalidate(){d=!1},end(){l&&(c(),l=!1)}}}function zo(t,e,o){const n={direction:"out"};let s=e(t,o,n),l=!0,r;const i=_e;i.r+=1;let a;function c(){const{delay:f=0,duration:d=300,easing:m=lt,tick:I=J,css:h}=s||bt;h&&(r=Xe(t,1,0,d,f,m,h));const A=yt()+f,w=A+d;Ae(()=>xe(t,!1,"start")),"inert"in t&&(a=t.inert,t.inert=!0),gt(L=>{if(l){if(L>=w)return I(0,1),xe(t,!1,"end"),--i.r||ve(i.c),!1;if(L>=A){const v=m((L-A)/d);I(1-v,v)}}return l})}return Ye(s)?_t().then(()=>{s=s(n),c()}):c(),{end(f){f&&"inert"in t&&(t.inert=a),f&&s.tick&&s.tick(1,0),l&&(r&&et(t,r),l=!1)}}}function Tt(t,e,o,n){let l=e(t,o,{direction:"both"}),r=n?0:1,i=null,a=null,c=null,f;function d(){c&&et(t,c)}function m(h,A){const w=h.b-r;return A*=Math.abs(w),{a:r,b:h.b,d:w,duration:A,start:h.start,end:h.start+A,group:h.group}}function I(h){const{delay:A=0,duration:w=300,easing:L=lt,tick:v=J,css:D}=l||bt,y={start:yt()+A,b:h};h||(y.group=_e,_e.r+=1),"inert"in t&&(h?f!==void 0&&(t.inert=f):(f=t.inert,t.inert=!0)),i||a?a=y:(D&&(d(),c=Xe(t,r,h,w,A,L,D)),h&&v(0,1),i=m(y,w),Ae(()=>xe(t,h,"start")),gt(F=>{if(a&&F>a.start&&(i=m(a,w),a=null,xe(t,i.b,"start"),D&&(d(),c=Xe(t,r,i.b,i.duration,0,L,l.css))),i){if(F>=i.end)v(r=i.b,1-r),xe(t,i.b,"end"),a||(i.b?d():--i.group.r||ve(i.group.c)),i=null;else if(F>=i.start){const q=F-i.start;r=i.a+i.d*L(q/i.duration),v(r,1-r)}}return!!(i||a)}))}return{run(h){Ye(l)?_t().then(()=>{l=l({direction:h?"in":"out"}),I(h)}):I(h)},end(){d(),i=a=null}}}function ce(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Wo(t,e){ue(t,1,1,()=>{e.delete(t.key)})}function Go(t,e,o,n,s,l,r,i,a,c,f,d){let m=t.length,I=l.length,h=m;const A={};for(;h--;)A[t[h].key]=h;const w=[],L=new Map,v=new Map,D=[];for(h=I;h--;){const T=d(s,l,h),p=o(T);let $=r.get(p);$?D.push(()=>$.p(T,e)):($=c(p,T),$.c()),L.set(p,w[h]=$),p in A&&v.set(p,Math.abs(h-A[p]))}const y=new Set,F=new Set;function q(T){se(T,1),T.m(i,f),r.set(T.key,T),f=T.first,I--}for(;m&&I;){const T=w[I-1],p=t[m-1],$=T.key,j=p.key;T===p?(f=T.first,m--,I--):L.has(j)?!r.has($)||y.has($)?q(T):F.has(j)?m--:v.get($)>v.get(j)?(F.add($),q(T)):(y.add(j),m--):(a(p,r),m--)}for(;m--;){const T=t[m];L.has(T.key)||a(T,r)}for(;I;)q(w[I-1]);return ve(D),w}function Ne(t){t&&t.c()}function $e(t,e,o){const{fragment:n,after_update:s}=t.$$;n&&n.m(e,o),Ae(()=>{const l=t.$$.on_mount.map(co).filter(Ye);t.$$.on_destroy?t.$$.on_destroy.push(...l):ve(l),t.$$.on_mount=[]}),s.forEach(Ae)}function Se(t,e){const o=t.$$;o.fragment!==null&&(Po(o.after_update),ve(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[])}function Ho(t,e){t.$$.dirty[0]===-1&&(Re.push(t),No(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function De(t,e,o,n,s,l,r=null,i=[-1]){const a=Fe;He(t);const c=t.$$={fragment:null,ctx:[],props:l,update:J,not_equal:s,bound:It(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:It(),dirty:i,skip_bound:!1,root:e.target||a.$$.root};r&&r(c.root);let f=!1;if(c.ctx=o?o(t,e.props||{},(d,m,...I)=>{const h=I.length?I[0]:m;return c.ctx&&s(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),f&&Ho(t,d)),m}):[],c.update(),f=!0,ve(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const d=$o(e.target);c.fragment&&c.fragment.l(d),d.forEach(G)}else c.fragment&&c.fragment.c();e.intro&&se(t.$$.fragment),$e(t,e.target,e.anchor),vo()}He(a)}class Ee{constructor(){it(this,"$$");it(this,"$$set")}$destroy(){Se(this,1),this.$destroy=J}$on(e,o){if(!Ye(o))return J;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(o),()=>{const s=n.indexOf(o);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Co(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Uo="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Uo);const Le=[];function ke(t,e=J){let o;const n=new Set;function s(i){if(Te(t,i)&&(t=i,o)){const a=!Le.length;for(const c of n)c[1](),Le.push(c,t);if(a){for(let c=0;c<Le.length;c+=2)Le[c][0](Le[c+1]);Le.length=0}}}function l(i){s(i(t))}function r(i,a=J){const c=[i,a];return n.add(c),n.size===1&&(o=e(s,l)||J),i(t),()=>{n.delete(c),n.size===0&&o&&(o(),o=null)}}return{set:s,update:l,subscribe:r}}const B=20,O={EMPTY:"empty",RESIDENTIAL:"residential",COMMERCIAL:"commercial",INDUSTRIAL:"industrial",ROAD:"road",PARK:"park"},tt={[O.RESIDENTIAL]:100,[O.COMMERCIAL]:200,[O.INDUSTRIAL]:300,[O.ROAD]:10,[O.PARK]:50,[O.EMPTY]:5},Fo=Array(B).fill(null).map(()=>Array(B).fill(null).map(()=>({type:O.EMPTY,population:0,level:1,hasPower:!0,hasWater:!0}))),be=ke(Fo),ot=ke(5e3),Ue=ke(0),me=ke(0),ft=ke(null),Mo=ke({residential:50,commercial:0,industrial:0}),ye=ke([]),nt=ke([]),_o=ke([{id:1,author:{name:"Mayor",isSystem:!0},text:"Welcome to SimTwitty! Start building zones to attract denizens.",time:0}]),at=["I'm trapped! No road out of here.","How do I get to work? The road is gone!","I can't get any deliveries. Moving out!","Is this an island? Where did the road go?","My car is useless without a street."],Bo=["The commute is killing me. Moving closer to work.","Spending 4 hours in traffic? No thanks. I'm out.","I miss my family. I spend all my time driving.","Gas prices are too high for this drive.","I need a job closer to home."],$t=["The commute to {dest} is just too far from here!","I can't believe I have to drive all the way to {dest} every day.","Why is {dest} so far away? My car is crying.","Traffic to {dest} is a nightmare. I'm moving.","I love working at {dest}, but the drive is ruinous."],St=["Just moved in near {dest}. Convenient!","Love being so close to {dest}.","Great location! {dest} is just a short walk away.","Finally, a short commute to {dest}.","This spot is perfect. I can see {dest} from my window."],Yo=["The smog is unbearable. I can't breathe!","Moving to the countryside. This air is toxic.","My laundry turns grey when I hang it outside.","Coughing all day. I'm leaving this smog city.","It smells like burning tires here. Bye!"],Ko=["This neighborhood isn't what it used to be.","Time to move on.","Found a better place in another city.","Property values are tanking. Selling now!","Just don't like the vibe here anymore."],xt=["optimist","pessimist","pragmatist","activist","cynic"];function Dt(){return xt[Math.floor(Math.random()*xt.length)]}const Et={optimist:{supportive:["@Mayor I knew you'd come through! You're amazing!","@Mayor this is exactly what we needed. Thank you!","@Mayor I have faith in you, Mayor. Let's make this city great!","@Mayor seeing progress like this makes me smile. Keep it up!","@Mayor another win for our city! You're on a roll!"],dismissive:["@Mayor I'm sure you're doing your best. We'll figure it out!","@Mayor no worries, I'm confident things will improve.","@Mayor I still believe in you, Mayor!","@Mayor Rome wasn't built in a day. We can wait.","@Mayor hiccups happen. We'll bounce back!"],actionTaken:["@Mayor YES! This is incredible! I'm so happy right now!","@Mayor you actually did it! I knew you would!","@Mayor this changes everything! Thank you so much!","@Mayor proof that dreams come true! Best Mayor ever!","@Mayor I'm telling everyone I know about this!"],ignored:["@Mayor I'm sure you're busy. I can wait.","@Mayor no rush, Mayor. We're patient here.","@Mayor I still have hope things will get better.","@Mayor maybe next time! I'm staying positive.","@Mayor busy schedule, I get it. We're good."]},pessimist:{supportive:["@Mayor wow, you actually listened? I'm shocked.","@Mayor I guess that's something. Don't get my hopes up though.","@Mayor nice words. Let's see if you actually follow through.","@Mayor probably a fluke, but thanks anyway.","@Mayor I was ready to be disappointed, but... okay."],dismissive:["@Mayor figures. Just more empty promises.","@Mayor of course you don't care. Why would you?","@Mayor typical. I'm out of here.","@Mayor expected nothing and still disappointed.","@Mayor another day, another letdown from City Hall."],actionTaken:["@Mayor okay, I'll admit it. That actually helped.","@Mayor well, I didn't expect that. Maybe you're not so bad.","@Mayor fine, you did something right for once.","@Mayor don't think this fixes everything, but it's a start.","@Mayor I hate to say it, but good job."],ignored:["@Mayor I knew you wouldn't actually do anything.","@Mayor just as I expected. Useless.","@Mayor moving to a city with a competent mayor.","@Mayor why do I even bother asking?","@Mayor silence is loud. Message received."]},pragmatist:{supportive:["@Mayor good to see you're taking action. What's the timeline?","@Mayor solid response. How will this affect the budget?","@Mayor makes sense. Let's see the results.","@Mayor reasonable approach. Proceed.","@Mayor I appreciate the transparency."],dismissive:["@Mayor that doesn't address the core issue.","@Mayor nice sentiment, but what's the actual plan?","@Mayor words without action won't fix anything.","@Mayor efficient refusal, but a refusal nonetheless.","@Mayor that's not a solution, that's a deflection."],actionTaken:["@Mayor efficient. My commute is already 20% faster.","@Mayor the numbers don't lie. This actually works.","@Mayor finally, some practical solutions.","@Mayor property value up 2%. Acceptable.","@Mayor logical move. Glad you saw the data."],ignored:["@Mayor still waiting on concrete action.","@Mayor talk is cheap. Show me results.","@Mayor I'll move somewhere with real infrastructure.","@Mayor inefficiency at its finest.","@Mayor no response? Not very professional."]},activist:{supportive:["@Mayor YES! This is what real leadership looks like!","@Mayor I'm organizing a thank you rally. You in?","@Mayor this is the change we've been fighting for!","@Mayor the people's voice has been heard! Victory!","@Mayor solidarity! Thank you for standing with us!"],dismissive:["@Mayor that's not nearly enough. We demand more!","@Mayor half-measures won't cut it. We need real change!","@Mayor you're not listening to what we actually need.","@Mayor shameful! The citizens deserve better!","@Mayor we will not be silenced by your excuses!"],actionTaken:["@Mayor THIS is what we've been asking for! Keep it up!","@Mayor you're finally on the right side of history!","@Mayor the movement is working! Let's push for more!","@Mayor direct action gets results! Well done!","@Mayor power to the people! (And the Mayor, this time)."],ignored:["@Mayor we're not going away until you listen.","@Mayor the people demand action, not excuses!","@Mayor moving to a city that values its citizens.","@Mayor your silence speaks volumes about your priorities.","@Mayor ignore us at your peril. Election year is coming."]},cynic:{supportive:["@Mayor oh please, what's the catch?","@Mayor nice PR stunt. What are you really after?","@Mayor I'll believe it when I see it.","@Mayor who paid you to say that?","@Mayor sure, sure. And pigs fly."],dismissive:["@Mayor lol, you actually think that'll work?","@Mayor spare me the BS, Mayor.","@Mayor typical politician nonsense.","@Mayor yawn. Wake me up when you actually do something.","@Mayor is this a bot account? Feels like it."],actionTaken:["@Mayor okay, I'm mildly impressed. Don't let it go to your head.","@Mayor even a broken clock is right twice a day.","@Mayor fine, you did one thing right. Congrats.","@Mayor must be an election year if you're actually working.","@Mayor barely adequate. But I'll take it."],ignored:["@Mayor shocking. Absolutely shocking.","@Mayor I'm leaving before this city gets worse.","@Mayor you're a joke, and so is this city.","@Mayor exactly the incompetence I expected.","@Mayor 0/10 administration. Would not recommend."]}},jt=["@Mayor we need a road at {home}!","@Mayor can you fix the pollution near {home}?","@Mayor my commute from {home} is brutal!","@Mayor why is {home} so isolated?","@Mayor {home} needs better infrastructure!","@Mayor this city needs more jobs!","@Mayor the pollution is unbearable!","@Mayor we need better infrastructure!","@Mayor traffic is out of control!","@Mayor we're overcrowded here!"],Lt=["@{target} tell the Mayor to FOCUS! The city is burning (figuratively)!","@{target} is right, @Mayor stop distracted tweeting and build some roads!","@Mayor maybe less social media, more city planning? Listen to @{target}!","@Mayor your approval rating drops every time you tweet nonsense.","Seriously @Mayor? @{target} is waiting for a response and you tweet this?","@{target} remember that bridge to nowhere the Mayor built? Fix that first.","@Mayor I'm still waiting for water in Zone C, just saying. @{target} knows what's up.","@Mayor easy to tweet from your ivory tower while we sit in traffic. Right @{target}?","Yeah @{target}, the Mayor clearly doesn't care about our commute.","@Mayor we need more parks! #GreenCity cc: @{target}","Hey @{target}, tell the Mayor to build a stadium! Or at least a hot dog stand.","@Mayor forget roads, we need a monorail! #Monorail","Agreed with @{target}. More industrial zones! I love the smell of smog.","@{target} for Mayor! At least they reply."],Jo={park:["park","parks","green","tree","trees","nature","garden","grass","picnic"],job:["job","jobs","work","employment","unemployed","factory","factories","commercial","business","hire","hiring"],road:["road","roads","street","streets","traffic","commute","drive","driving","car","infrastructure"],pollution:["pollution","smog","dirty","air","smell","toxic","cough","smoke","industrial"],housing:["home","house","housing","apartment","residential","living","neighborhood","rent"]};function Zo(t){const e=t.toLowerCase(),o=[];for(const[s,l]of Object.entries(Jo))l.some(r=>e.includes(r))&&o.push(s);const n=e.includes("?")||/^(what|how|do|does|are|is|can|will|why|where|when|who)\b/i.test(e.trim());return{topics:o,isQuestion:n}}function Vo(t,e){const o=t.toLowerCase(),n=e.home?e.home.toLowerCase():"",s=e.work?e.work.toLowerCase():"";return(o.includes(n)||o.includes(s))&&(o.includes("build")||o.includes("fix")||o.includes("improve")||o.includes("road"))||o.includes("build")||o.includes("fix")||o.includes("improve")?"actionTaken":o.includes("sorry")||o.includes("thanks")||o.includes("appreciate")||o.includes("listen")||o.includes("understand")||o.includes("working on")?"supportive":o.includes("no")||o.includes("can't")||o.includes("won't")||o.includes("impossible")||o.includes("not possible")?"dismissive":"ignored"}function wt(t){const e=addrToCoord(t.home);if(!e)return{exists:!1,distance:999,quality:"none"};const o=oe(be),n=[];for(let i=0;i<B;i++)for(let a=0;a<B;a++)o[i][a].type===O.PARK&&n.push({x:a,y:i});if(n.length===0)return{exists:!1,distance:999,quality:"none"};const s=ht(e.x,e.y,n),l=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2));let r="far";return l<=3?r="close":l<=7&&(r="moderate"),{exists:!0,distance:Math.round(l),quality:r,address:Be(s.x,s.y)}}function st(t){if(!t.work)return{employed:!1,unemployedDays:t.unemployedDays||0,quality:t.unemployedDays>10?"desperate":"looking"};const e=addrToCoord(t.home),o=addrToCoord(t.work);if(!e||!o)return{employed:!0,commute:999,quality:"unknown"};const n=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2));let s="long";return n<=5?s="short":n<=10&&(s="moderate"),{employed:!0,commute:Math.round(n),quality:s,workAddress:Be(o.x,o.y),daysMissed:t.daysMissed||0}}function kt(t){const e=addrToCoord(t.home);if(!e)return{hasAccess:!1,quality:"none"};const o=oe(be),n=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];let s=0;for(const{dx:l,dy:r}of n){const i=e.x+l,a=e.y+r;i>=0&&i<B&&a>=0&&a<B&&o[a][i].type===O.ROAD&&s++}return{hasAccess:s>0,quality:s===0?"none":s>=2?"good":"basic"}}function bo(t){const e=addrToCoord(t.home);if(!e)return{level:0,quality:"unknown"};const o=oe(be),s=wo(o)[e.y][e.x];let l="clean";return s>20?l="toxic":s>10?l="bad":s>5&&(l="moderate"),{level:Math.round(s),quality:l}}function Qo(t){return t.work&&!t.daysMissed&&t.unemployedDays===0?"happy":!t.work||t.unemployedDays>5?"desperate":t.daysMissed>3||t.unemployedDays>15?"angry":"neutral"}function Xo(t,e,o){const n=t.personality||"optimist",s=Qo(t),{topics:l,isQuestion:r}=Zo(e);if(r&&l.length>0){const a=en(t,l);if(a)return a}if(t.lastMention&&!t.lastMention.resolved&&l.length>0){const a=tn(t,l,e);if(a)return ye.update(c=>{const f=c.findIndex(d=>d.id===t.id);if(f!==-1){const d={...c[f]};d.lastMention&&(d.lastMention.resolved=!0),c[f]=d}return c}),a}if(l.length>0&&!r){const a=on(t,l,e);if(a)return a}let i=Et[n][o]||Et[n].ignored;return s==="desperate"&&o==="ignored"&&(i=["@Mayor I'm leaving. This city doesn't care about us.","@Mayor I can't afford to stay here anymore.","@Mayor goodbye. I'm done waiting."]),s==="angry"&&o==="dismissive"&&(i=["@Mayor you just cost me my home. I hope you're happy.","@Mayor I trusted you. Never again.","@Mayor you've lost my vote forever."]),s==="happy"&&o==="supportive"&&(i=["@Mayor you're the best! This city is amazing!","@Mayor thanks for everything you do!","@Mayor I love living here!"]),i[Math.floor(Math.random()*i.length)]}function en(t,e,o){const n=[];for(const s of e){if(s==="park"){const l=wt(t);l.exists&&l.quality==="close"?n.push(`@Mayor Yes! I love the park at ${l.address}. I go there all the time.`):l.exists&&l.quality==="moderate"?n.push(`@Mayor There's one at ${l.address}, but it's a bit of a walk.`):l.exists&&l.quality==="far"?n.push(`@Mayor The nearest park is at ${l.address}. Too far for me honestly.`):n.push("@Mayor What park? I don't see any green space around here.")}if(s==="job"){const l=st(t);l.employed?l.quality==="short"?n.push(`@Mayor I work at ${l.workAddress}. The commute is great!`):l.quality==="moderate"?n.push(`@Mayor I have a job at ${l.workAddress}. Commute could be better.`):n.push(`@Mayor I work at ${l.workAddress}, but the commute is brutal.`):l.unemployedDays>20?n.push(`@Mayor Still unemployed. It's been ${l.unemployedDays} days now.`):n.push("@Mayor Looking for work. No luck yet.")}if(s==="road"){const l=kt(t),r=st(t);l.hasAccess?r.employed&&r.daysMissed>0?n.push("@Mayor The roads are broken. I can't get to work!"):l.quality==="good"?n.push("@Mayor Road access is fine. No complaints there."):n.push("@Mayor We have a road, but traffic is getting bad."):n.push("@Mayor No road access here! I'm basically trapped.")}if(s==="pollution"){const l=bo(t);l.quality==="toxic"?n.push("@Mayor The air is disgusting! I can barely breathe here."):l.quality==="bad"?n.push("@Mayor Pollution is pretty bad. I smell the factories every morning."):l.quality==="moderate"?n.push("@Mayor Air quality could be better, but it's tolerable."):n.push("@Mayor Air is clean here. No pollution issues.")}s==="housing"&&n.push(`@Mayor I live at ${t.home}. It's home.`)}return n.length>1?n.slice(0,2).join(" "):n.length===1?n[0]:null}function tn(t,e,o){if(!t.lastMention)return null;const n=t.lastMention.topic;if(oe(me)-t.lastMention.time,!e.includes(n))return null;let l=!1,r=null;if(n==="road"){const i=kt(t);i.hasAccess&&i.quality!=="none"&&(l=!0,r="@Mayor You actually fixed the road issue! Thank you!")}else if(n==="park"){const i=wt(t);i.exists&&i.quality!=="far"&&(l=!0,r="@Mayor The new park is great! Thanks for listening.")}else if(n==="job")st(t).employed&&(l=!0,r="@Mayor I found work! Things are looking up.");else if(n==="pollution"){const i=bo(t);(i.quality==="clean"||i.quality==="moderate")&&(l=!0,r="@Mayor Air quality improved! I can breathe again.")}if(!l&&(o.toLowerCase().includes("fix")||o.toLowerCase().includes("build")||o.toLowerCase().includes("working"))){const i=t.personality||"optimist";i==="optimist"?r="@Mayor I appreciate you trying! Hope it works out.":i==="pessimist"?r="@Mayor I'll believe it when I see it.":i==="pragmatist"?r="@Mayor Okay, but I need to see results soon.":r="@Mayor Thanks for the update, Mayor."}return r}function on(t,e,o){const n=o.toLowerCase();if(!(n.includes("built")||n.includes("build")||n.includes("added")||n.includes("fixed")))return null;for(const l of e){if(l==="park"){const r=wt(t);if(r.exists){if(r.quality==="far")return`@Mayor There's a park, but it's way too far from me at ${r.address}.`}else return"@Mayor What park? I don't see any parks around here."}if(l==="road"&&!kt(t).hasAccess)return"@Mayor Fixed the roads? I still don't have road access!";if(l==="job"&&!st(t).employed)return"@Mayor More jobs? I'm still unemployed!"}return null}function nn(t,e){const o=oe(me);ye.update(n=>{const s=n.findIndex(l=>l.id===t.id);if(s!==-1){const l={...n[s]};l.lastMention={topic:e,time:o,resolved:!1},n[s]=l}return n})}function sn(t){let e=jt[Math.floor(Math.random()*jt.length)];return e=e.replace("{home}",t.home||"here"),e}function Ge(){const t=["Urban","City","Metro","Town","Village","Street","Road","Lane","Park","Zone"],e=["Planner","Dweller","Sim","Citizen","Neighbor","Walker","Driver","Builder","Fan","Critic"];return t[Math.floor(Math.random()*t.length)]+e[Math.floor(Math.random()*e.length)]+Math.floor(Math.random()*1e3)}function ln(t){const e=oe(me),o=oe(ye);if(t){if(t.denizen)return t.denizen;if(t.x!=null&&t.y!=null){const a=o.find(c=>c.home===he(t.x,t.y));if(a)return a}}const n=o.filter(a=>!a.left);if(n.length>0)return n[Math.floor(Math.random()*n.length)];const s=Ge();let l="Homeless",r=null,i=e;return t&&t.type===O.RESIDENTIAL&&t.x!=null?l=he(t.x,t.y):l=he(Math.floor(Math.random()*B),Math.floor(Math.random()*B)),{name:s,home:l,work:r,since:i,history:[{type:"move_in",time:i,home:l}],isSystem:!1}}function dt(t,e,o){const n=Be(e,o);if(t===O.COMMERCIAL){const s=["Commerce Square","The Market","Shopping Center","Mall","Corner Store","Business Plaza","Trade Center","Retail Park"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}else if(t===O.INDUSTRIAL){const s=["Industrial Park","Factory District","The Works","Manufacturing Hub","Tech Park","Warehouse Zone","Power Station","Refinery"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}else if(t===O.RESIDENTIAL){const s=["The Apartments","Housing Block","Residences","Living Quarters","The Lofts","Condos","Villas","Estates"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}else if(t===O.PARK){const s=["Green Park","City Garden","Recreation Area","The Commons","Nature Reserve","Playground","Central Park","Botanical Garden"];return`${s[Math.floor(Math.random()*s.length)]} at ${n}`}return`Zone at ${n}`}function ht(t,e,o){let n=999,s=null;for(const l of o){const r=Math.sqrt(Math.pow(l.x-t,2)+Math.pow(l.y-e,2));r<n&&(n=r,s=l)}return s}function he(t,e){const o=String.fromCharCode(65+e),n=t+1;return`${o}${n}`}function Be(t,e){const o=String.fromCharCode(65+e),n=t+1,s=n%10,l=n%100;let r="th";return s==1&&l!=11&&(r="st"),s==2&&l!=12&&(r="nd"),s==3&&l!=13&&(r="rd"),`${o} St & ${n}${r}`}function we(t,e=null,o=null){_o.update(n=>{let s=e;return s?typeof s=="string"&&(s={name:s,isSystem:!0}):s=ln(o),[{id:Date.now()+Math.random(),author:s,text:t,time:oe(me)},...n].slice(0,50)})}let Ke=[];function rn(t){const o=oe(ye).filter(l=>l.name!==t&&!l.left);if(o.length<3)return;const n=3+Math.floor(Math.random()*3),s=[];for(let l=0;l<n;l++)if(o.length>0){const r=Math.floor(Math.random()*o.length);s.push(o[r]),o.splice(r,1)}nt.update(l=>{const r=[...l],i=oe(me);return s.forEach((a,c)=>{let f=Lt[Math.floor(Math.random()*Lt.length)];f=f.replace("{target}",t),r.push({denizenName:a.name,playerTweet:"",forcedResponse:f,respondAt:i+2+c+Math.floor(Math.random()*2)})}),r})}function an(t,e){const o=oe(me);Ke.filter(s=>s.name===t&&o-s.time<60).length>=1&&rn(t),Ke.push({name:t,time:o}),Ke=Ke.filter(s=>o-s.time<100),nt.update(s=>{const l=o+1+Math.floor(Math.random()*3);return[...s,{denizenName:t,playerTweet:e,respondAt:l}]})}function cn(t){const e=t.match(/@(\w+)/);return e?e[1]:null}function un(){me.update(T=>T+1);const t=oe(me),e=[],o=[],n=[],s=[],l=new Set,r=new Set,i=(T,p,$)=>{s.push({text:T,author:p,context:$})},a=oe(be);oe(Ue);let c=0,f=0;a.forEach(T=>{T.forEach(p=>{p.type===O.RESIDENTIAL?c+=p.population:(p.type===O.COMMERCIAL||p.type===O.INDUSTRIAL)&&(f+=p.population)})});let d=50+(f-c),m=(c-f)*.5,I=(c-f)*.5;const h=T=>Math.max(-100,Math.min(100,T));d=h(d),m=h(m),I=h(I),Mo.set({residential:d,commercial:m,industrial:I});const{roadNetworkMap:A,networks:w}=dn(a),L=wo(a),v=T=>{if(!T)return null;try{const p=T.match(/[A-Z]+/),$=T.match(/\d+/);if(!p||!$)return null;const j=p[0],_=parseInt($[0]),K=j.charCodeAt(0)-65;return{x:_-1,y:K}}catch{return null}},D=f-c;let y=0;f>0&&D>0&&(y=Math.min(1,D/f*2)),be.update(T=>{let p=0;const $=T.map(x=>x.map(S=>({...S,traffic:0}))),j=oe(ye),_=Array(B).fill(null).map(()=>Array(B).fill(0)),K=new Map;for(const x of j)if(x.home&&x.work&&!x.left){const S=v(x.home),k=v(x.work);if(S&&k){const Z=T[S.y][S.x],P=T[k.y][k.x];if(!(Z.type!==O.RESIDENTIAL||P.type!==O.COMMERCIAL&&P.type!==O.INDUSTRIAL)){const te=Nt(S.x,S.y,T),W=Nt(k.x,k.y,T);if(te.length>0&&W.length>0){const Y=`${S.x},${S.y}-${k.x},${k.y}`;let b=K.get(Y);if(b||(b=fn(te,W,T),b&&K.set(Y,b)),b){for(const C of b)_[C.y][C.x]+=1;r.add(x.id)}else l.add(x.id)}else l.add(x.id)}}}new Set(j.filter(x=>x.lostJob).map(x=>x.id));for(let x=0;x<B;x++)for(let S=0;S<B;S++)$[x][S].type===O.ROAD&&($[x][S].traffic=_[x][S]);for(let x=0;x<B;x++)for(let S=0;S<B;S++){const k=$[x][S];let Z=null,P=!1;const te=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:W,dy:Y}of te){const b=S+W,C=x+Y;if(b>=0&&b<B&&C>=0&&C<B&&T[C][b].type===O.ROAD&&(P=!0,Z=A[C][b],Z))break}if(k.type===O.RESIDENTIAL){const W=L[x][S];if(P&&Z){const Y=w.get(Z);let b=999;Y&&Y.jobTiles.length>0&&(b=Rt(S,x,Y.jobTiles));const R=b<=15;let z=d/100;if(W>5&&(z-=.5),W>20&&(z-=1),b<5?z+=.2:b>10&&(z-=.1),R&&z>0){if(k.population<50*k.level&&Math.random()<z&&(k.population+=1,e.push({x:S,y:x}),Math.random()<.05&&R&&Y&&Y.jobTiles.length>0)){const E=ht(S,x,Y.jobTiles);if(E){const X=a[E.y][E.x],V=dt(X.type,E.x,E.y),ee=St[Math.floor(Math.random()*St.length)],Q={x:S,y:x,type:k.type,jobX:E.x,jobY:E.y,isGrowth:!0};i(ee.replace("{dest}",V),null,Q)}}}else if(k.population>0&&(!R||W>20||z<-.2)&&(k.population-=1,o.push({x:S,y:x}),Math.random()<.1)){let E=Ko,X=null,V=null;if(!P)E=at;else if(W>20)E=Yo;else if(!R){if(Y&&Y.jobTiles.length>0){const Q=ht(S,x,Y.jobTiles);if(Q){const le=a[Q.y][Q.x],fe=dt(le.type,Q.x,Q.y);X=$t[Math.floor(Math.random()*$t.length)].replace("{dest}",fe),V={jobX:Q.x,jobY:Q.y}}}X||(E=Bo)}const ee={x:S,y:x,type:k.type,isLeaving:!0,...V};i(X||E[Math.floor(Math.random()*E.length)],null,ee)}}else if(k.population>0&&(k.population-=1,o.push({x:S,y:x}),Math.random()<.1)){const Y={x:S,y:x,type:k.type,isLeaving:!0};i(at[Math.floor(Math.random()*at.length)],null,Y)}p+=k.population}else if(k.type===O.COMMERCIAL)if(P&&Z){const W=w.get(Z);let Y=999;W&&W.resTiles.length>0&&(Y=Rt(S,x,W.resTiles)),Y<=20&&m>0?k.population<25*k.level&&Math.random()<m/100&&(k.population+=1,n.push({x:S,y:x,type:k.type})):k.population>0?(Y>20?(k.daysIsolated=(k.daysIsolated||0)+1,k.daysIsolated>=7&&(k.population=0,k.daysIsolated=0)):k.daysIsolated=0,k.population>0&&(m<-20||Math.random()<y)&&(Math.random()<.05||Math.random()<y)&&(k.population-=1)):k.daysIsolated=0}else k.population>0&&(k.population=0);else if(k.type===O.INDUSTRIAL)if(P&&Z){const W=w.get(Z);W&&W.resTiles.length>0&&I>0?k.population<25*k.level&&Math.random()<I/100&&(k.population+=1,n.push({x:S,y:x,type:k.type})):k.population>0?(!W||W.resTiles.length===0?(k.daysIsolated=(k.daysIsolated||0)+1,k.daysIsolated>=7&&(k.population=0,k.daysIsolated=0)):k.daysIsolated=0,k.population>0&&(I<-20||Math.random()<y)&&(Math.random()<.05||Math.random()<y)&&(k.population-=1)):k.daysIsolated=0}else k.population>0&&(k.population=0)}return Ue.set(p),$}),ye.update(T=>{let p=[...T];const $=oe(be),j=new Map;for(const b of p)b.work&&!b.left&&j.set(b.work,(j.get(b.work)||0)+1);const _=[];for(let b=0;b<B;b++)for(let C=0;C<B;C++){const R=$[b][C];if(R.type===O.COMMERCIAL||R.type===O.INDUSTRIAL){const z=he(C,b),E=j.get(z)||0,X=R.population-E,V=new Set,ee=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:Q,dy:le}of ee){const fe=C+Q,Ie=b+le;if(fe>=0&&fe<B&&Ie>=0&&Ie<B&&$[Ie][fe].type===O.ROAD){const ie=A[Ie][fe];ie&&V.add(ie)}}for(let Q=0;Q<X;Q++)_.push({x:C,y:b,type:R.type,addr:z,networks:Array.from(V)})}}for(let b=_.length-1;b>0;b--){const C=Math.floor(Math.random()*(b+1));[_[b],_[C]]=[_[C],_[b]]}const K=b=>{const C=v(b);if(!C)return-1;const R=new Set,z=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:E,dy:X}of z){const V=C.x+E,ee=C.y+X;if(V>=0&&V<B&&ee>=0&&ee<B&&$[ee][V].type===O.ROAD){const Q=A[ee][V];Q&&R.add(Q)}}return _.findIndex(E=>E.networks.some(X=>R.has(X)))},x=[],S=[],k=[];for(let b=0;b<p.length;b++){const C=p[b];let R=!1;r.has(C.id)?C.daysMissed>0&&(C.daysMissed=0,R=!0):l.has(C.id)&&(C.daysMissed=(C.daysMissed||0)+1,R=!0,C.daysMissed>=7&&(C.work&&i("Fired for not showing up!",C,{x:-1,y:-1}),C.work=null,C.daysMissed=0,C.unemployedDays=0,C.history.push({type:"fired",time:t}))),!C.work&&!C.left?(C.unemployedDays=(C.unemployedDays||0)+1,R=!0,C.unemployedDays>30&&S.push({x:-1,y:-1,denizenId:C.id})):C.work&&C.unemployedDays>0&&(C.unemployedDays=0,R=!0),R&&(p[b]={...C})}let Z=[...o],P=[...e];for(;Z.length>0&&P.length>0;){const b=Z.shift(),C=P.shift();x.push({from:b,to:C})}S.push(...Z),k.push(...P);for(const b of x){const C=he(b.from.x,b.from.y),R=he(b.to.x,b.to.y),z=p.findIndex(E=>E.home===C&&!E.left);if(z!==-1){const E={...p[z]};if(E.history=[...E.history||[],{type:"move",time:t,from:C,to:R}],E.home=R,!E.work&&_.length>0){const X=K(E.home);if(X!==-1){const V=_.splice(X,1)[0];E.work=V.addr,E.history.push({type:"new_job",time:t,work:E.work})}}if(p[z]=E,Math.random()<.1){const X={x:b.to.x,y:b.to.y,isGrowth:!0};i(`Moved from ${C} to ${R}. Fresh start!`,E,X)}}else S.push(b.from),k.push(b.to)}if(_.length>0)for(let b=0;b<p.length&&_.length!==0;b++){const C=p[b];if(!C.left&&!C.work){const R=K(C.home);if(R!==-1){const z=_.splice(R,1)[0],E=z.addr,X={...C};if(X.work=E,X.history=[...C.history||[],{type:"new_job",time:t,work:E}],p[b]=X,Math.random()<.3){const V=[`Finally got a job at ${E}!`,`Hired! Starting work at ${E}.`,`Off to work at ${E}. So happy!`,`Unemployment over. Hello ${E}.`],ee=V[Math.floor(Math.random()*V.length)];i(ee,X,{x:z.x,y:z.y,type:z.type})}}}}for(const b of S){const C=he(b.x,b.y),R=p.findIndex(z=>z.home===C&&!z.left);if(R!==-1){const z={...p[R]};z.left=t,z.history=[...z.history||[],{type:"left_city",time:t}];for(const E of s)E.context&&E.context.isLeaving&&E.context.x===b.x&&E.context.y===b.y&&(E.author||(E.author=z));p[R]=z}}const te=[];for(const b of k){const C=he(b.x,b.y);let R=null;if(_.length>0){const E=K(C);E!==-1&&(R=_.splice(E,1)[0].addr)}const z={id:Ge()+Math.random(),name:Ge(),home:C,work:R,since:t,history:[{type:"move_in",time:t,home:C}],isSystem:!1,personality:Dt(),playerInteractions:[],lastMention:null};te.push(z),p.push(z)}for(const b of s){let C=b.author;if(!C&&b.context){if(b.context.isGrowth){let R=te.find(z=>z.home===he(b.context.x,b.context.y));if(!R){const z=he(b.context.x,b.context.y);R=p.find(E=>E.home===z&&!E.left)}R&&(C=R)}else if(!b.context.isLeaving){if(b.context.x!=null){const R=p.find(z=>z.home===he(b.context.x,b.context.y)&&!z.left);R&&(C=R)}}}we(b.text,C,b.context)}const W=new Map,Y=new Map;for(let b=0;b<p.length;b++){const C=p[b];C.left||(C.home&&(W.has(C.home)||W.set(C.home,[]),W.get(C.home).push(b)),C.work&&(Y.has(C.work)||Y.set(C.work,[]),Y.get(C.work).push(b)))}for(let b=0;b<B;b++)for(let C=0;C<B;C++){const R=$[b][C],z=he(C,b),E=W.get(z)||[];if(R.type===O.RESIDENTIAL){if(E.length>R.population){const V=E.length-R.population;for(let ee=0;ee<V;ee++){const Q=E.pop(),le=p[Q],fe={...le,left:t,history:[...le.history||[],{type:"evicted",time:t}]};p[Q]=fe}}else if(E.length<R.population){const V=R.population-E.length;for(let ee=0;ee<V;ee++){const Q={id:Ge()+Math.random(),name:Ge(),home:z,work:null,since:t,history:[{type:"drift_correction_spawn",time:t,home:z}],isSystem:!1,personality:Dt(),playerInteractions:[],lastMention:null};p.push(Q)}}}else if(E.length>0)for(const V of E){const ee=p[V],Q={...ee,left:t,history:[...ee.history||[],{type:"evicted_bulldoze",time:t}]};p[V]=Q}const X=Y.get(z)||[];if(R.type===O.COMMERCIAL||R.type===O.INDUSTRIAL)if(X.length>R.population){const V=X.length-R.population;for(let ee=0;ee<V;ee++){const Q=X.pop(),le=p[Q],fe={...le,work:null,history:[...le.history||[],{type:"fired_excess",time:t}]};p[Q]=fe,le.isSystem||i("Laid off due to downsizing.",fe,{x:C,y:b,type:R.type})}}else X.length<R.population}for(let b=0;b<p.length;b++){const C=p[b];if(!C.left&&C.work){const R=v(C.work);let z=!1;if(R){const E=$[R.y][R.x];(E.type===O.COMMERCIAL||E.type===O.INDUSTRIAL)&&(z=!0)}if(!z){const E={...C,work:null,history:[...C.history||[],{type:"workplace_demolished",time:t}]};p[b]=E}}}return p});{const T=oe(ye),p=new Map;for(const $ of T)!$.left&&$.work&&p.set($.work,(p.get($.work)||0)+1);be.update($=>$.map((j,_)=>j.map((K,x)=>{if(K.type===O.COMMERCIAL||K.type===O.INDUSTRIAL){const S=he(x,_),k=p.get(S)||0;if(K.population>k)return{...K,population:k}}return K})))}if(e.length>0&&Math.random()<.05){const T=["Moving in today! So excited.","Boxes unpacked. Hello city!","Just got the keys to my new place.","New in town, looking for recommendations.","Wow, this city is growing fast!"],p=oe(ye).filter($=>$.since===t&&!$.isSystem);if(p.length>0){const $=p[Math.floor(Math.random()*p.length)];we(T[Math.floor(Math.random()*T.length)],$)}}if(Math.random()<.01){const T=["I love the smell of industry in the morning.","We need more parks!","Traffic is getting bad.","Is there a coffee shop nearby?","The mayor is doing a great job... I think.","Why is the power always out? Oh wait, it works."];we(T[Math.floor(Math.random()*T.length)])}const q=oe(nt).filter(T=>T.respondAt===t);for(const T of q){const p=oe(ye).find($=>$.name===T.denizenName&&!$.left);if(p)if(T.forcedResponse)we(T.forcedResponse,p);else{const $=Vo(T.playerTweet,p),j=Xo(p,T.playerTweet,$);we(j,p)}}if(nt.update(T=>T.filter(p=>p.respondAt>t)),oe(me)%120===0&&Math.random()<.3){const p=oe(ye).filter($=>!$.left&&($.unemployedDays>10||$.daysMissed>3||$.work&&oe(me)-$.since>50));if(p.length>0){const $=p[Math.floor(Math.random()*p.length)],j=sn($);let _="general";j.includes("road")||j.includes("commute")?_="road":j.includes("pollution")?_="pollution":j.includes("job")?_="job":j.includes("infrastructure")&&(_="road"),nn($,_),we(j,$)}}oe(me)%5===0&&ot.update(T=>T+Math.floor(oe(Ue)*.5))}function Rt(t,e,o){let n=999;for(const s of o){const l=Math.sqrt(Math.pow(s.x-t,2)+Math.pow(s.y-e,2));l<n&&(n=l)}return n}function wo(t){const e=Array(B).fill(null).map(()=>Array(B).fill(0)),o=[];for(let n=0;n<B;n++)for(let s=0;s<B;s++)t[n][s].type===O.INDUSTRIAL&&o.push({x:s,y:n,intensity:10+t[n][s].population});if(o.length>0)for(let n=0;n<B;n++)for(let s=0;s<B;s++){let l=0;for(const r of o){const i=Math.sqrt(Math.pow(r.x-s,2)+Math.pow(r.y-n,2));i<8&&(l+=r.intensity/(i+1))}e[n][s]=l}return e}function Nt(t,e,o){const n=[],s=[{dx:0,dy:0},{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:l,dy:r}of s){const i=t+l,a=e+r;i>=0&&i<B&&a>=0&&a<B&&o[a][i].type===O.ROAD&&n.push({x:i,y:a})}return n}function fn(t,e,o){if(!t||t.length===0||!e||e.length===0)return null;const n=new Set(e.map(r=>`${r.x},${r.y}`)),s=t.map(r=>({x:r.x,y:r.y,path:[{x:r.x,y:r.y}]})),l=new Set(t.map(r=>`${r.x},${r.y}`));for(;s.length>0;){const{x:r,y:i,path:a}=s.shift();if(n.has(`${r},${i}`))return a;const c=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const{dx:f,dy:d}of c){const m=r+f,I=i+d;m>=0&&m<B&&I>=0&&I<B&&!l.has(`${m},${I}`)&&o[I][m].type===O.ROAD&&(l.add(`${m},${I}`),s.push({x:m,y:I,path:[...a,{x:m,y:I}]}))}}return null}function dn(t){const e=new Map,o=Array(B).fill(null).map(()=>Array(B).fill(0));let n=1;const s=new Set;for(let l=0;l<B;l++)for(let r=0;r<B;r++)if(t[l][r].type===O.ROAD&&!s.has(`${r},${l}`)){const i=n++;e.set(i,{jobTiles:[],resTiles:[],roadCount:0});const a=[{x:r,y:l}];for(s.add(`${r},${l}`),o[l][r]=i,e.get(i).roadCount++;a.length>0;){const{x:c,y:f}=a.shift();[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(({dx:m,dy:I})=>{const h=c+m,A=f+I;if(h>=0&&h<B&&A>=0&&A<B){const w=t[A][h];if(w.type===O.ROAD)s.has(`${h},${A}`)||(s.add(`${h},${A}`),o[A][h]=i,e.get(i).roadCount++,a.push({x:h,y:A}));else{const L=e.get(i);w.type===O.RESIDENTIAL?L.resTiles.some(v=>v.x===h&&v.y===A)||L.resTiles.push({x:h,y:A}):(w.type===O.COMMERCIAL||w.type===O.INDUSTRIAL)&&(L.jobTiles.some(v=>v.x===h&&v.y===A)||L.jobTiles.push({x:h,y:A}))}}})}}return{roadNetworkMap:o,networks:e}}function hn(t,e,o){const n=oe(ot),s=tt[o];if(n>=s){const r=oe(be)[e][t];if(r.type===O.ROAD&&o!==O.ROAD){if(Math.random()<.7){const i=Be(t,e),a=[`@Mayor Hey! I used the road at ${i} to get to work!`,`@Mayor My commute just got ruined by work at ${i}.`,`@Mayor Why are we destroying infrastructure at ${i}?`,`@Mayor Now I have to take the long way around ${i}.`,`@Mayor Bulldozers at ${i} woke me up!`];we(a[Math.floor(Math.random()*a.length)])}}else if(r.type!==o&&o!==O.EMPTY&&o!==O.ROAD&&Math.random()<.4){const i=Be(t,e),a=dt(o,t,e);let c=[];o===O.RESIDENTIAL?c=[`New housing coming to ${i}. Nice!`,`Looks like they are building ${a}.`,`More neighbors at ${i}. Hope they are quiet.`,`Finally developing the lot at ${i}.`]:o===O.COMMERCIAL?c=[`Ooh, a new shop opening at ${i}?`,`I heard ${a} is being built.`,`Traffic is going to be bad at ${i} with all the shoppers.`,`Can't wait to visit ${a}!`]:o===O.INDUSTRIAL?c=[`Ugh, they are building a factory at ${i}.`,`There goes the neighborhood. ${a} is huge.`,`More jobs at ${i}, but at what cost?`,`I hope ${a} doesn't smell bad.`]:o===O.PARK&&(c=[`Yay! A new park at ${i}.`,`Love that they preserved green space at ${i}.`,`Going to take my dog to ${a}.`,`Picnic time at ${i}!`]),c.length>0&&we(c[Math.floor(Math.random()*c.length)])}ot.update(i=>i-s),be.update(i=>{const a=[...i];return a[e][t]={...a[e][t],type:o,population:0,level:1},a})}}function Ot(t,e,o){const n=t.slice();return n[10]=e[o],n}function pn(t){let e,o,n,s,l,r,i,a,c=t[1].length+"",f,d,m,I,h=t[1].filter(qt).length+"",A,w,L,v,D=t[1].filter(zt).length+"",y,F,q,T,p,$,j,_,K,x=ce(t[3]),S=[];for(let k=0;k<x.length;k+=1)S[k]=Pt(Ot(t,x,k));return{c(){e=g("section"),o=g("h3"),o.textContent="Denizen Debugger",n=N(),s=g("input"),l=N(),r=g("div"),i=g("span"),a=H("Total: "),f=H(c),d=N(),m=g("span"),I=H("Active: "),A=H(h),w=N(),L=g("span"),v=H("Employed: "),y=H(D),F=N(),q=g("div"),T=g("table"),p=g("thead"),p.innerHTML='<tr><th class="svelte-1d5o944">Name</th> <th class="svelte-1d5o944">Home</th> <th class="svelte-1d5o944">Work</th> <th class="svelte-1d5o944">Status</th> <th class="svelte-1d5o944">Missed</th> <th class="svelte-1d5o944">Unemployed</th></tr>',$=N(),j=g("tbody");for(let k=0;k<S.length;k+=1)S[k].c();M(o,"class","svelte-1d5o944"),M(s,"type","text"),M(s,"placeholder","Search name, home, work..."),M(s,"class","search-input svelte-1d5o944"),M(r,"class","stats-row svelte-1d5o944"),M(T,"class","svelte-1d5o944"),M(q,"class","table-container svelte-1d5o944"),M(e,"class","debug-section svelte-1d5o944")},m(k,Z){U(k,e,Z),u(e,o),u(e,n),u(e,s),Ze(s,t[0]),u(e,l),u(e,r),u(r,i),u(i,a),u(i,f),u(r,d),u(r,m),u(m,I),u(m,A),u(r,w),u(r,L),u(L,v),u(L,y),u(e,F),u(e,q),u(q,T),u(T,p),u(T,$),u(T,j);for(let P=0;P<S.length;P+=1)S[P]&&S[P].m(j,null);_||(K=re(s,"input",t[8]),_=!0)},p(k,Z){if(Z&1&&s.value!==k[0]&&Ze(s,k[0]),Z&2&&c!==(c=k[1].length+"")&&ne(f,c),Z&2&&h!==(h=k[1].filter(qt).length+"")&&ne(A,h),Z&2&&D!==(D=k[1].filter(zt).length+"")&&ne(y,D),Z&8){x=ce(k[3]);let P;for(P=0;P<x.length;P+=1){const te=Ot(k,x,P);S[P]?S[P].p(te,Z):(S[P]=Pt(te),S[P].c(),S[P].m(j,null))}for(;P<S.length;P+=1)S[P].d(1);S.length=x.length}},d(k){k&&G(e),Ce(S,k),_=!1,K()}}}function yn(t){let e,o,n;return{c(){e=g("section"),e.innerHTML='<h3 class="svelte-1d5o944">Zones</h3> <div class="legend-item svelte-1d5o944"><div class="swatch res svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Residential (Green)</strong> <p class="svelte-1d5o944">Where people live. Darkens as population grows.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="swatch com svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Commercial (Blue)</strong> <p class="svelte-1d5o944">Shops and offices. Needs people and goods.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="swatch ind svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Industrial (Yellow)</strong> <p class="svelte-1d5o944">Factories. Creates jobs and goods.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="swatch park svelte-1d5o944"></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Park (Dark Green)</strong> <p class="svelte-1d5o944">Increases happiness of nearby residents.</p></div></div>',o=N(),n=g("section"),n.innerHTML='<h3 class="svelte-1d5o944">Traffic Indicators</h3> <p class="section-desc svelte-1d5o944">Moving dots on roads indicate traffic flow.</p> <div class="legend-item svelte-1d5o944"><div class="traffic-swatch svelte-1d5o944"><div class="dot green svelte-1d5o944"></div></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Green Dot</strong> <p class="svelte-1d5o944">Light traffic. Free flowing.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="traffic-swatch svelte-1d5o944"><div class="dot amber svelte-1d5o944"></div></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Amber Dot</strong> <p class="svelte-1d5o944">Moderate traffic.</p></div></div> <div class="legend-item svelte-1d5o944"><div class="traffic-swatch svelte-1d5o944"><div class="dot red svelte-1d5o944"></div></div> <div class="desc svelte-1d5o944"><strong class="svelte-1d5o944">Red Dot</strong> <p class="svelte-1d5o944">Heavy traffic. Congestion may slow growth.</p></div></div>'},m(s,l){U(s,e,l),U(s,o,l),U(s,n,l)},p:J,d(s){s&&(G(e),G(o),G(n))}}}function Pt(t){let e,o,n=t[10].name+"",s,l,r,i=t[10].home+"",a,c,f,d=(t[10].work||"-")+"",m,I,h,A=t[10].left?"Left":"Active",w,L,v,D=(t[10].daysMissed||0)+"",y,F,q,T=(t[10].unemployedDays||0)+"",p,$;return{c(){e=g("tr"),o=g("td"),s=H(n),l=N(),r=g("td"),a=H(i),c=N(),f=g("td"),m=H(d),I=N(),h=g("td"),w=H(A),L=N(),v=g("td"),y=H(D),F=N(),q=g("td"),p=H(T),$=N(),M(o,"class","svelte-1d5o944"),M(r,"class","svelte-1d5o944"),M(f,"class","svelte-1d5o944"),M(h,"class","svelte-1d5o944"),M(v,"class","svelte-1d5o944"),M(q,"class","svelte-1d5o944"),M(e,"class","svelte-1d5o944"),ge(e,"left",t[10].left)},m(j,_){U(j,e,_),u(e,o),u(o,s),u(e,l),u(e,r),u(r,a),u(e,c),u(e,f),u(f,m),u(e,I),u(e,h),u(h,w),u(e,L),u(e,v),u(v,y),u(e,F),u(e,q),u(q,p),u(e,$)},p(j,_){_&8&&n!==(n=j[10].name+"")&&ne(s,n),_&8&&i!==(i=j[10].home+"")&&ne(a,i),_&8&&d!==(d=(j[10].work||"-")+"")&&ne(m,d),_&8&&A!==(A=j[10].left?"Left":"Active")&&ne(w,A),_&8&&D!==(D=(j[10].daysMissed||0)+"")&&ne(y,D),_&8&&T!==(T=(j[10].unemployedDays||0)+"")&&ne(p,T),_&8&&ge(e,"left",j[10].left)},d(j){j&&G(e)}}}function mn(t){let e,o,n,s,l,r,i,a,c,f,d,m,I,h,A;function w(D,y){return D[2]?pn:yn}let L=w(t),v=L(t);return{c(){e=g("div"),o=g("div"),n=g("button"),n.textContent="Ã—",s=N(),l=g("h2"),l.textContent="Legend & Help",r=N(),i=g("div"),a=g("button"),a.textContent="Legend",c=N(),f=g("button"),f.textContent="Debug Tools",d=N(),v.c(),m=N(),I=g("div"),I.textContent="v0.0.0",M(n,"class","close-btn svelte-1d5o944"),M(l,"class","svelte-1d5o944"),M(a,"class","svelte-1d5o944"),ge(a,"active",!t[2]),M(f,"class","svelte-1d5o944"),ge(f,"active",t[2]),M(i,"class","tabs svelte-1d5o944"),M(I,"class","version svelte-1d5o944"),M(o,"class","modal-content svelte-1d5o944"),M(e,"class","modal-backdrop svelte-1d5o944")},m(D,y){U(D,e,y),u(e,o),u(o,n),u(o,s),u(o,l),u(o,r),u(o,i),u(i,a),u(i,c),u(i,f),u(o,d),v.m(o,null),u(o,m),u(o,I),h||(A=[re(n,"click",t[4]),re(a,"click",t[6]),re(f,"click",t[7]),re(o,"click",yo(t[5])),re(e,"click",t[4])],h=!0)},p(D,[y]){y&4&&ge(a,"active",!D[2]),y&4&&ge(f,"active",D[2]),L===(L=w(D))&&v?v.p(D,y):(v.d(1),v=L(D),v&&(v.c(),v.m(o,m)))},i:J,o:J,d(D){D&&G(e),v.d(),h=!1,ve(A)}}}const qt=t=>!t.left,zt=t=>!t.left&&t.work;function gn(t,e,o){let n,s;Me(t,ye,I=>o(1,s=I));const l=Lo();let r=!1,i="";function a(){l("close")}function c(I){go.call(this,t,I)}const f=()=>o(2,r=!1),d=()=>o(2,r=!0);function m(){i=this.value,o(0,i)}return t.$$.update=()=>{t.$$.dirty&3&&o(3,n=s.filter(I=>{if(!i)return!0;const h=i.toLowerCase();return I.name.toLowerCase().includes(h)||I.home.toLowerCase().includes(h)||I.work&&I.work.toLowerCase().includes(h)}))},[i,s,r,n,a,c,f,d,m]}class vn extends Ee{constructor(e){super(),De(this,e,gn,mn,Te,{})}}function Wt(t){let e,o;return e=new vn({}),e.$on("close",t[6]),{c(){Ne(e.$$.fragment)},m(n,s){$e(e,n,s),o=!0},p:J,i(n){o||(se(e.$$.fragment,n),o=!0)},o(n){ue(e.$$.fragment,n),o=!1},d(n){Se(e,n)}}}function Mn(t){let e,o,n,s,l,r,i,a,c,f,d,m,I,h,A,w,L,v,D,y,F,q,T,p,$,j,_,K,x,S,k,Z,P,te,W,Y,b,C,R,z,E,X,V,ee,Q,le,fe,Ie,ie=t[0]&&Wt(t);return{c(){e=g("header"),o=g("div"),n=g("span"),n.textContent="Money",s=N(),l=g("span"),r=H("$"),i=H(t[1]),a=N(),c=g("div"),f=g("span"),f.textContent="Population",d=N(),m=g("span"),I=H(t[2]),h=N(),A=g("div"),w=g("span"),w.textContent="Day",L=N(),v=g("span"),D=H(t[3]),y=N(),F=g("div"),q=g("div"),q.textContent="RCI",T=N(),p=g("div"),$=g("div"),j=g("div"),_=g("div"),K=N(),x=g("span"),x.textContent="R",S=N(),k=g("div"),Z=g("div"),P=g("div"),te=N(),W=g("span"),W.textContent="C",Y=N(),b=g("div"),C=g("div"),R=g("div"),z=N(),E=g("span"),E.textContent="I",X=N(),V=g("button"),V.textContent="?",ee=N(),ie&&ie.c(),Q=vt(),M(n,"class","label svelte-1ylazd0"),M(l,"class","value svelte-1ylazd0"),M(o,"class","stat svelte-1ylazd0"),M(f,"class","label svelte-1ylazd0"),M(m,"class","value svelte-1ylazd0"),M(c,"class","stat svelte-1ylazd0"),M(w,"class","label svelte-1ylazd0"),M(v,"class","value svelte-1ylazd0"),M(A,"class","stat svelte-1ylazd0"),M(q,"class","rci-label svelte-1ylazd0"),M(_,"class","bar res svelte-1ylazd0"),pe(_,"height",Math.max(5,Math.min(100,t[4].residential))+"%"),M(j,"class","bar-track svelte-1ylazd0"),M(x,"class","bar-label svelte-1ylazd0"),M($,"class","bar-group svelte-1ylazd0"),M(P,"class","bar com svelte-1ylazd0"),pe(P,"height",Math.max(5,Math.min(100,t[4].commercial))+"%"),M(Z,"class","bar-track svelte-1ylazd0"),M(W,"class","bar-label svelte-1ylazd0"),M(k,"class","bar-group svelte-1ylazd0"),M(R,"class","bar ind svelte-1ylazd0"),pe(R,"height",Math.max(5,Math.min(100,t[4].industrial))+"%"),M(C,"class","bar-track svelte-1ylazd0"),M(E,"class","bar-label svelte-1ylazd0"),M(b,"class","bar-group svelte-1ylazd0"),M(p,"class","bars svelte-1ylazd0"),M(F,"class","rci-container svelte-1ylazd0"),M(V,"class","help-btn svelte-1ylazd0"),M(V,"title","Legend & Help"),M(e,"class","svelte-1ylazd0")},m(ae,de){U(ae,e,de),u(e,o),u(o,n),u(o,s),u(o,l),u(l,r),u(l,i),u(e,a),u(e,c),u(c,f),u(c,d),u(c,m),u(m,I),u(e,h),u(e,A),u(A,w),u(A,L),u(A,v),u(v,D),u(e,y),u(e,F),u(F,q),u(F,T),u(F,p),u(p,$),u($,j),u(j,_),u($,K),u($,x),u(p,S),u(p,k),u(k,Z),u(Z,P),u(k,te),u(k,W),u(p,Y),u(p,b),u(b,C),u(C,R),u(b,z),u(b,E),u(e,X),u(e,V),U(ae,ee,de),ie&&ie.m(ae,de),U(ae,Q,de),le=!0,fe||(Ie=re(V,"click",t[5]),fe=!0)},p(ae,[de]){(!le||de&2)&&ne(i,ae[1]),(!le||de&4)&&ne(I,ae[2]),(!le||de&8)&&ne(D,ae[3]),(!le||de&16)&&pe(_,"height",Math.max(5,Math.min(100,ae[4].residential))+"%"),(!le||de&16)&&pe(P,"height",Math.max(5,Math.min(100,ae[4].commercial))+"%"),(!le||de&16)&&pe(R,"height",Math.max(5,Math.min(100,ae[4].industrial))+"%"),ae[0]?ie?(ie.p(ae,de),de&1&&se(ie,1)):(ie=Wt(ae),ie.c(),se(ie,1),ie.m(Q.parentNode,Q)):ie&&(qe(),ue(ie,1,1,()=>{ie=null}),ze())},i(ae){le||(se(ie),le=!0)},o(ae){ue(ie),le=!1},d(ae){ae&&(G(e),G(ee),G(Q)),ie&&ie.d(ae),fe=!1,Ie()}}}function _n(t,e,o){let n,s,l,r;Me(t,ot,f=>o(1,n=f)),Me(t,Ue,f=>o(2,s=f)),Me(t,me,f=>o(3,l=f)),Me(t,Mo,f=>o(4,r=f));let i=!1;return[i,n,s,l,r,()=>o(0,i=!0),()=>o(0,i=!1)]}class bn extends Ee{constructor(e){super(),De(this,e,_n,Mn,Te,{})}}function Gt(t,e,o){const n=t.slice();return n[3]=e[o],n}function wn(t){let e;return{c(){e=g("span"),e.textContent=`$${tt[t[3].id]}`,M(e,"class","cost svelte-omakiu")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Ht(t){let e,o,n,s,l,r,i=tt[t[3].id]&&wn(t);function a(){return t[2](t[3])}return{c(){e=g("button"),o=g("span"),o.textContent=`${t[3].label}`,n=N(),i&&i.c(),s=N(),M(o,"class","label svelte-omakiu"),pe(e,"--color",t[3].color),M(e,"class","svelte-omakiu"),ge(e,"active",t[0]===t[3].id)},m(c,f){U(c,e,f),u(e,o),u(e,n),i&&i.m(e,null),u(e,s),l||(r=re(e,"click",a),l=!0)},p(c,f){t=c,tt[t[3].id]&&i.p(t,f),f&3&&ge(e,"active",t[0]===t[3].id)},d(c){c&&G(e),i&&i.d(),l=!1,r()}}}function kn(t){let e,o=ce(t[1]),n=[];for(let s=0;s<o.length;s+=1)n[s]=Ht(Gt(t,o,s));return{c(){e=g("div");for(let s=0;s<n.length;s+=1)n[s].c();M(e,"class","toolbar svelte-omakiu")},m(s,l){U(s,e,l);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(s,[l]){if(l&3){o=ce(s[1]);let r;for(r=0;r<o.length;r+=1){const i=Gt(s,o,r);n[r]?n[r].p(i,l):(n[r]=Ht(i),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=o.length}},i:J,o:J,d(s){s&&G(e),Ce(n,s)}}}function In(t,e,o){let n;Me(t,ft,r=>o(0,n=r));const s=[{id:O.RESIDENTIAL,label:"Res",color:"#4ade80"},{id:O.COMMERCIAL,label:"Com",color:"#60a5fa"},{id:O.INDUSTRIAL,label:"Ind",color:"#facc15"},{id:O.ROAD,label:"Road",color:"#4b5563"},{id:O.PARK,label:"Park",color:"#15803d"},{id:O.EMPTY,label:"Bulldoze",color:"#ef4444"}];return[n,s,r=>ft.set(r.id)]}class Cn extends Ee{constructor(e){super(),De(this,e,In,kn,Te,{})}}function An(t){let e;function o(l,r){return l[0].traffic>0?Sn:$n}let n=o(t),s=n(t);return{c(){s.c(),e=vt()},m(l,r){s.m(l,r),U(l,e,r)},p(l,r){n===(n=o(l))&&s?s.p(l,r):(s.d(1),s=n(l),s&&(s.c(),s.m(e.parentNode,e)))},d(l){l&&G(e),s.d(l)}}}function Tn(t){let e,o=t[0].population+"",n;return{c(){e=g("span"),n=H(o),M(e,"class","pop svelte-194cfaq")},m(s,l){U(s,e,l),u(e,n)},p(s,l){l&1&&o!==(o=s[0].population+"")&&ne(n,o)},d(s){s&&G(e)}}}function $n(t){let e;return{c(){e=g("span"),e.textContent="â€¢",M(e,"class","road-mark svelte-194cfaq")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Sn(t){let e,o;return{c(){e=g("div"),o=g("div"),M(o,"class","car svelte-194cfaq"),pe(o,"background-color",Ut(t[0].traffic)),M(e,"class","traffic-container svelte-194cfaq"),pe(e,"animation-duration",3/(1+t[0].traffic*.1)+"s")},m(n,s){U(n,e,s),u(e,o)},p(n,s){s&1&&pe(o,"background-color",Ut(n[0].traffic)),s&1&&pe(e,"animation-duration",3/(1+n[0].traffic*.1)+"s")},d(n){n&&G(e)}}}function xn(t){let e,o,n;function s(i,a){if(i[0].population>0)return Tn;if(i[0].type==="road")return An}let l=s(t),r=l&&l(t);return{c(){e=g("div"),r&&r.c(),M(e,"class","tile svelte-194cfaq"),pe(e,"background-color",t[1]),M(e,"role","button")},m(i,a){U(i,e,a),r&&r.m(e,null),o||(n=re(e,"click",t[2]),o=!0)},p(i,[a]){l===(l=s(i))&&r?r.p(i,a):(r&&r.d(1),r=l&&l(i),r&&(r.c(),r.m(e,null))),a&2&&pe(e,"background-color",i[1])},i:J,o:J,d(i){i&&G(e),r&&r.d(),o=!1,n()}}}function Dn(t,e){let o;switch(t){case"residential":o=[74,222,128];break;case"commercial":o=[96,165,250];break;case"industrial":o=[250,204,21];break;case"road":return"#4b5563";case"park":return"#14532d";default:return"#f3f4f6"}const l=1-Math.min(1,e/(t==="residential"?50:25))*.4;return`rgb(${Math.floor(o[0]*l)}, ${Math.floor(o[1]*l)}, ${Math.floor(o[2]*l)})`}function Ut(t){return t>5?"#ef4444":t>2?"#fbbf24":"#4ade80"}function En(t,e,o){let n,s;Me(t,ft,c=>o(5,s=c));let{x:l}=e,{y:r}=e,{tile:i}=e;function a(){hn(l,r,s)}return t.$$set=c=>{"x"in c&&o(3,l=c.x),"y"in c&&o(4,r=c.y),"tile"in c&&o(0,i=c.tile)},t.$$.update=()=>{t.$$.dirty&1&&o(1,n=Dn(i.type,i.population))},[i,n,a,l,r]}class jn extends Ee{constructor(e){super(),De(this,e,En,xn,Te,{x:3,y:4,tile:0})}}function Ft(t,e,o){const n=t.slice();return n[3]=e[o],n[5]=o,n}function Bt(t,e,o){const n=t.slice();return n[6]=e[o],n[8]=o,n}function Yt(t,e,o){const n=t.slice();return n[3]=e[o],n}function Kt(t,e,o){const n=t.slice();return n[11]=e[o],n}function Jt(t){let e;return{c(){e=g("div"),e.textContent=`${t[11]}`,M(e,"class","col-label svelte-1sqmj97")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Zt(t){let e;return{c(){e=g("div"),e.textContent=`${t[3]}`,M(e,"class","row-label svelte-1sqmj97")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Vt(t){let e,o;return e=new jn({props:{x:t[8],y:t[5],tile:t[6]}}),{c(){Ne(e.$$.fragment)},m(n,s){$e(e,n,s),o=!0},p(n,s){const l={};s&1&&(l.tile=n[6]),e.$set(l)},i(n){o||(se(e.$$.fragment,n),o=!0)},o(n){ue(e.$$.fragment,n),o=!1},d(n){Se(e,n)}}}function Qt(t){let e,o,n,s=ce(t[3]),l=[];for(let i=0;i<s.length;i+=1)l[i]=Vt(Bt(t,s,i));const r=i=>ue(l[i],1,1,()=>{l[i]=null});return{c(){e=g("div");for(let i=0;i<l.length;i+=1)l[i].c();o=N(),M(e,"class","row svelte-1sqmj97")},m(i,a){U(i,e,a);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null);u(e,o),n=!0},p(i,a){if(a&1){s=ce(i[3]);let c;for(c=0;c<s.length;c+=1){const f=Bt(i,s,c);l[c]?(l[c].p(f,a),se(l[c],1)):(l[c]=Vt(f),l[c].c(),se(l[c],1),l[c].m(e,o))}for(qe(),c=s.length;c<l.length;c+=1)r(c);ze()}},i(i){if(!n){for(let a=0;a<s.length;a+=1)se(l[a]);n=!0}},o(i){l=l.filter(Boolean);for(let a=0;a<l.length;a+=1)ue(l[a]);n=!1},d(i){i&&G(e),Ce(l,i)}}}function Ln(t){let e,o,n,s,l,r,i,a,c,f,d=ce(t[1]),m=[];for(let v=0;v<d.length;v+=1)m[v]=Jt(Kt(t,d,v));let I=ce(t[2]),h=[];for(let v=0;v<I.length;v+=1)h[v]=Zt(Yt(t,I,v));let A=ce(t[0]),w=[];for(let v=0;v<A.length;v+=1)w[v]=Qt(Ft(t,A,v));const L=v=>ue(w[v],1,1,()=>{w[v]=null});return{c(){e=g("div"),o=g("div"),n=g("div"),s=N();for(let v=0;v<m.length;v+=1)m[v].c();l=N(),r=g("div"),i=g("div");for(let v=0;v<h.length;v+=1)h[v].c();a=N(),c=g("div");for(let v=0;v<w.length;v+=1)w[v].c();M(n,"class","corner svelte-1sqmj97"),M(o,"class","header-row svelte-1sqmj97"),M(i,"class","row-labels svelte-1sqmj97"),M(c,"class","grid-container svelte-1sqmj97"),M(r,"class","main-area svelte-1sqmj97"),M(e,"class","layout svelte-1sqmj97")},m(v,D){U(v,e,D),u(e,o),u(o,n),u(o,s);for(let y=0;y<m.length;y+=1)m[y]&&m[y].m(o,null);u(e,l),u(e,r),u(r,i);for(let y=0;y<h.length;y+=1)h[y]&&h[y].m(i,null);u(r,a),u(r,c);for(let y=0;y<w.length;y+=1)w[y]&&w[y].m(c,null);f=!0},p(v,[D]){if(D&2){d=ce(v[1]);let y;for(y=0;y<d.length;y+=1){const F=Kt(v,d,y);m[y]?m[y].p(F,D):(m[y]=Jt(F),m[y].c(),m[y].m(o,null))}for(;y<m.length;y+=1)m[y].d(1);m.length=d.length}if(D&4){I=ce(v[2]);let y;for(y=0;y<I.length;y+=1){const F=Yt(v,I,y);h[y]?h[y].p(F,D):(h[y]=Zt(F),h[y].c(),h[y].m(i,null))}for(;y<h.length;y+=1)h[y].d(1);h.length=I.length}if(D&1){A=ce(v[0]);let y;for(y=0;y<A.length;y+=1){const F=Ft(v,A,y);w[y]?(w[y].p(F,D),se(w[y],1)):(w[y]=Qt(F),w[y].c(),se(w[y],1),w[y].m(c,null))}for(qe(),y=A.length;y<w.length;y+=1)L(y);ze()}},i(v){if(!f){for(let D=0;D<A.length;D+=1)se(w[D]);f=!0}},o(v){w=w.filter(Boolean);for(let D=0;D<w.length;D+=1)ue(w[D]);f=!1},d(v){v&&G(e),Ce(m,v),Ce(h,v),Ce(w,v)}}}function Rn(t,e,o){let n;Me(t,be,r=>o(0,n=r));const s=Array.from({length:20},(r,i)=>i+1),l=Array.from({length:20},(r,i)=>String.fromCharCode(65+i));return[n,s,l]}class Nn extends Ee{constructor(e){super(),De(this,e,Rn,Ln,Te,{})}}function On(t){const e=t-1;return e*e*e+1}function pt(t,{delay:e=0,duration:o=400,easing:n=lt}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:o,easing:n,css:l=>`opacity: ${l*s}`}}function Pn(t,{delay:e=0,duration:o=400,easing:n=On,x:s=0,y:l=0,opacity:r=0}={}){const i=getComputedStyle(t),a=+i.opacity,c=i.transform==="none"?"":i.transform,f=a*(1-r),[d,m]=Ct(s),[I,h]=Ct(l);return{delay:e,duration:o,easing:n,css:(A,w)=>`
			transform: ${c} translate(${(1-A)*d}${m}, ${(1-A)*I}${h});
			opacity: ${a-f*w}`}}function Xt(t,e,o){const n=t.slice();return n[24]=e[o],n}function eo(t,e,o){const n=t.slice();return n[27]=e[o],n}function to(t,e,o){const n=t.slice();return n[30]=e[o],n[32]=o,n}function oo(t){let e,o=ce(t[4]),n=[];for(let s=0;s<o.length;s+=1)n[s]=no(to(t,o,s));return{c(){e=g("ul");for(let s=0;s<n.length;s+=1)n[s].c();M(e,"class","autocomplete-list svelte-1itj0d0")},m(s,l){U(s,e,l);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(s,l){if(l[0]&560){o=ce(s[4]);let r;for(r=0;r<o.length;r+=1){const i=to(s,o,r);n[r]?n[r].p(i,l):(n[r]=no(i),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=o.length}},d(s){s&&G(e),Ce(n,s)}}}function no(t){let e,o,n=t[30]+"",s,l,r,i;function a(){return t[19](t[30])}function c(){return t[20](t[32])}return{c(){e=g("li"),o=H("@"),s=H(n),l=N(),M(e,"class","svelte-1itj0d0"),ge(e,"selected",t[32]===t[5])},m(f,d){U(f,e,d),u(e,o),u(e,s),u(e,l),r||(i=[re(e,"click",a),re(e,"mouseenter",c)],r=!0)},p(f,d){t=f,d[0]&16&&n!==(n=t[30]+"")&&ne(s,n),d[0]&32&&ge(e,"selected",t[32]===t[5])},d(f){f&&G(e),r=!1,ve(i)}}}function qn(t){let e;return{c(){e=g("div"),e.innerHTML="<p>No one lives here yet...</p>",M(e,"class","empty-state svelte-1itj0d0")},m(o,n){U(o,e,n)},p:J,i:J,o:J,d(o){o&&G(e)}}}function zn(t){let e=[],o=new Map,n,s,l=ce(t[0]);const r=i=>i[27].id;for(let i=0;i<l.length;i+=1){let a=eo(t,l,i),c=r(a);o.set(c,e[i]=so(c,a))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();n=vt()},m(i,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,a);U(i,n,a),s=!0},p(i,a){a[0]&4097&&(l=ce(i[0]),qe(),e=Go(e,a,r,1,i,l,o,n.parentNode,Wo,so,n,eo),ze())},i(i){if(!s){for(let a=0;a<l.length;a+=1)se(e[a]);s=!0}},o(i){for(let a=0;a<e.length;a+=1)ue(e[a]);s=!1},d(i){i&&G(n);for(let a=0;a<e.length;a+=1)e[a].d(i)}}}function so(t,e){let o,n,s,l=e[27].author.name+"",r,i,a,c=e[27].text+"",f,d,m,I=e[27].time+"",h,A,w,L,v,D,y;function F(){return e[21](e[27])}return{key:t,first:null,c(){o=g("div"),n=g("div"),s=H("@"),r=H(l),i=N(),a=g("div"),f=H(c),d=N(),m=g("div"),h=H(I),A=N(),M(n,"class","author svelte-1itj0d0"),ge(n,"clickable",!e[27].author.isSystem),M(a,"class","content svelte-1itj0d0"),M(m,"class","time svelte-1itj0d0"),M(o,"class","tweet svelte-1itj0d0"),this.first=o},m(q,T){U(q,o,T),u(o,n),u(n,s),u(n,r),u(o,i),u(o,a),u(a,f),u(o,d),u(o,m),u(m,h),u(o,A),v=!0,D||(y=re(n,"click",F),D=!0)},p(q,T){e=q,(!v||T[0]&1)&&l!==(l=e[27].author.name+"")&&ne(r,l),(!v||T[0]&1)&&ge(n,"clickable",!e[27].author.isSystem),(!v||T[0]&1)&&c!==(c=e[27].text+"")&&ne(f,c),(!v||T[0]&1)&&I!==(I=e[27].time+"")&&ne(h,I)},i(q){v||(q&&Ae(()=>{v&&(L&&L.end(1),w=qo(o,Pn,{y:20,duration:300}),w.start())}),v=!0)},o(q){w&&w.invalidate(),q&&(L=zo(o,pt,{})),v=!1},d(q){q&&G(o),q&&L&&L.end(),D=!1,y()}}}function lo(t){let e,o,n,s,l=t[2].name+"",r,i,a,c,f,d,m,I,h,A=t[2].home+"",w,L,v,D,y,F,q,T=t[2].since+"",p,$,j=t[2].left?`${t[2].left}`:"Now",_,K,x,S,k,Z,P=t[2].work&&io(t),te=t[2].history&&t[2].history.length>0&&ro(t);return{c(){e=g("div"),o=g("div"),n=g("div"),s=g("h4"),r=H(l),i=N(),a=g("button"),a.textContent="Ã—",c=N(),f=g("div"),d=g("div"),m=g("span"),m.textContent="Home:",I=N(),h=g("span"),w=H(A),L=N(),P&&P.c(),v=N(),D=g("div"),y=g("span"),y.textContent="Resident:",F=N(),q=g("span"),p=H(T),$=H(" â†’ "),_=H(j),K=N(),te&&te.c(),M(s,"class","svelte-1itj0d0"),M(a,"class","close-btn svelte-1itj0d0"),M(n,"class","modal-header svelte-1itj0d0"),M(m,"class","label svelte-1itj0d0"),M(h,"class","value svelte-1itj0d0"),M(d,"class","detail-row svelte-1itj0d0"),M(y,"class","label svelte-1itj0d0"),M(q,"class","value svelte-1itj0d0"),M(D,"class","detail-row svelte-1itj0d0"),M(f,"class","profile-details svelte-1itj0d0"),M(o,"class","modal svelte-1itj0d0"),M(e,"class","modal-backdrop svelte-1itj0d0")},m(W,Y){U(W,e,Y),u(e,o),u(o,n),u(n,s),u(s,r),u(n,i),u(n,a),u(o,c),u(o,f),u(f,d),u(d,m),u(d,I),u(d,h),u(h,w),u(f,L),P&&P.m(f,null),u(f,v),u(f,D),u(D,y),u(D,F),u(D,q),u(q,p),u(q,$),u(q,_),u(f,K),te&&te.m(f,null),S=!0,k||(Z=[re(a,"click",t[13]),re(o,"click",yo(t[16])),re(e,"click",t[13])],k=!0)},p(W,Y){(!S||Y[0]&4)&&l!==(l=W[2].name+"")&&ne(r,l),(!S||Y[0]&4)&&A!==(A=W[2].home+"")&&ne(w,A),W[2].work?P?P.p(W,Y):(P=io(W),P.c(),P.m(f,v)):P&&(P.d(1),P=null),(!S||Y[0]&4)&&T!==(T=W[2].since+"")&&ne(p,T),(!S||Y[0]&4)&&j!==(j=W[2].left?`${W[2].left}`:"Now")&&ne(_,j),W[2].history&&W[2].history.length>0?te?te.p(W,Y):(te=ro(W),te.c(),te.m(f,null)):te&&(te.d(1),te=null)},i(W){S||(W&&Ae(()=>{S&&(x||(x=Tt(e,pt,{},!0)),x.run(1))}),S=!0)},o(W){W&&(x||(x=Tt(e,pt,{},!1)),x.run(0)),S=!1},d(W){W&&G(e),P&&P.d(),te&&te.d(),W&&x&&x.end(),k=!1,ve(Z)}}}function io(t){let e,o,n,s,l=t[2].work+"",r;return{c(){e=g("div"),o=g("span"),o.textContent="Work:",n=N(),s=g("span"),r=H(l),M(o,"class","label svelte-1itj0d0"),M(s,"class","value svelte-1itj0d0"),M(e,"class","detail-row svelte-1itj0d0")},m(i,a){U(i,e,a),u(e,o),u(e,n),u(e,s),u(s,r)},p(i,a){a[0]&4&&l!==(l=i[2].work+"")&&ne(r,l)},d(i){i&&G(e)}}}function ro(t){let e,o,n,s,l=ce(t[2].history),r=[];for(let i=0;i<l.length;i+=1)r[i]=ao(Xt(t,l,i));return{c(){e=g("div"),o=g("span"),o.textContent="History",n=N(),s=g("ul");for(let i=0;i<r.length;i+=1)r[i].c();M(o,"class","label svelte-1itj0d0"),M(s,"class","history-list svelte-1itj0d0"),M(e,"class","history-section svelte-1itj0d0")},m(i,a){U(i,e,a),u(e,o),u(e,n),u(e,s);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,null)},p(i,a){if(a[0]&4){l=ce(i[2].history);let c;for(c=0;c<l.length;c+=1){const f=Xt(i,l,c);r[c]?r[c].p(f,a):(r[c]=ao(f),r[c].c(),r[c].m(s,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=l.length}},d(i){i&&G(e),Ce(r,i)}}}function Wn(t){let e;return{c(){e=H("Left the city")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Gn(t){let e;return{c(){e=H("Moved in (correction)")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Hn(t){let e;return{c(){e=H("Evicted (zone demolished)")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Un(t){let e;return{c(){e=H("Evicted (overcrowding)")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Fn(t){let e;return{c(){e=H("Lost job (workplace closed)")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Bn(t){let e;return{c(){e=H("Laid off (downsizing)")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Yn(t){let e;return{c(){e=H("Lost job (fired for absence)")},m(o,n){U(o,e,n)},p:J,d(o){o&&G(e)}}}function Kn(t){let e,o=t[24].work+"",n;return{c(){e=H("Started job at "),n=H(o)},m(s,l){U(s,e,l),U(s,n,l)},p(s,l){l[0]&4&&o!==(o=s[24].work+"")&&ne(n,o)},d(s){s&&(G(e),G(n))}}}function Jn(t){let e,o=t[24].from+"",n,s,l=t[24].to+"",r;return{c(){e=H("Moved "),n=H(o),s=H(" â†’ "),r=H(l)},m(i,a){U(i,e,a),U(i,n,a),U(i,s,a),U(i,r,a)},p(i,a){a[0]&4&&o!==(o=i[24].from+"")&&ne(n,o),a[0]&4&&l!==(l=i[24].to+"")&&ne(r,l)},d(i){i&&(G(e),G(n),G(s),G(r))}}}function Zn(t){let e,o=t[24].home+"",n;return{c(){e=H("Moved into "),n=H(o)},m(s,l){U(s,e,l),U(s,n,l)},p(s,l){l[0]&4&&o!==(o=s[24].home+"")&&ne(n,o)},d(s){s&&(G(e),G(n))}}}function ao(t){let e,o,n=t[24].time+"",s,l,r,i;function a(d,m){if(d[24].type==="move_in")return Zn;if(d[24].type==="move")return Jn;if(d[24].type==="new_job")return Kn;if(d[24].type==="fired")return Yn;if(d[24].type==="fired_excess")return Bn;if(d[24].type==="workplace_demolished")return Fn;if(d[24].type==="evicted")return Un;if(d[24].type==="evicted_bulldoze")return Hn;if(d[24].type==="drift_correction_spawn")return Gn;if(d[24].type==="left_city")return Wn}let c=a(t),f=c&&c(t);return{c(){e=g("li"),o=g("span"),s=H(n),l=N(),r=g("span"),f&&f.c(),i=N(),M(o,"class","history-time svelte-1itj0d0"),M(r,"class","history-desc"),M(e,"class","svelte-1itj0d0")},m(d,m){U(d,e,m),u(e,o),u(o,s),u(e,l),u(e,r),f&&f.m(r,null),u(e,i)},p(d,m){m[0]&4&&n!==(n=d[24].time+"")&&ne(s,n),c===(c=a(d))&&f?f.p(d,m):(f&&f.d(1),f=c&&c(d),f&&(f.c(),f.m(r,null)))},d(d){d&&G(e),f&&f.d()}}}function Vn(t){let e,o,n,s,l,r,i,a,c,f,d,m,I,h,A,w,L,v,D,y=t[3]&&t[4].length>0&&oo(t);const F=[zn,qn],q=[];function T($,j){return $[7]>0?0:1}h=T(t),A=q[h]=F[h](t);let p=t[2]&&lo(t);return{c(){e=g("div"),o=g("h3"),o.textContent="SimTwitty Feed",n=N(),s=g("div"),l=g("textarea"),r=N(),y&&y.c(),i=N(),a=g("div"),c=g("button"),f=H("Twit 'em"),m=N(),I=g("div"),A.c(),w=N(),p&&p.c(),M(o,"class","svelte-1itj0d0"),M(l,"placeholder","What's happening in the city, Mayor?"),M(l,"class","svelte-1itj0d0"),c.disabled=d=!t[1].trim(),M(c,"class","svelte-1itj0d0"),M(a,"class","tweet-actions svelte-1itj0d0"),M(s,"class","tweet-input svelte-1itj0d0"),M(I,"class","messages-container svelte-1itj0d0"),M(e,"class","feed svelte-1itj0d0")},m($,j){U($,e,j),u(e,o),u(e,n),u(e,s),u(s,l),t[17](l),Ze(l,t[1]),u(s,r),y&&y.m(s,null),u(s,i),u(s,a),u(a,c),u(c,f),u(e,m),u(e,I),q[h].m(I,null),u(e,w),p&&p.m(e,null),L=!0,v||(D=[re(l,"input",t[18]),re(l,"keydown",t[11]),re(l,"input",t[8]),re(l,"click",t[8]),re(c,"click",t[10])],v=!0)},p($,j){j[0]&2&&Ze(l,$[1]),$[3]&&$[4].length>0?y?y.p($,j):(y=oo($),y.c(),y.m(s,i)):y&&(y.d(1),y=null),(!L||j[0]&2&&d!==(d=!$[1].trim()))&&(c.disabled=d);let _=h;h=T($),h===_?q[h].p($,j):(qe(),ue(q[_],1,1,()=>{q[_]=null}),ze(),A=q[h],A?A.p($,j):(A=q[h]=F[h]($),A.c()),se(A,1),A.m(I,null)),$[2]?p?(p.p($,j),j[0]&4&&se(p,1)):(p=lo($),p.c(),se(p,1),p.m(e,null)):p&&(qe(),ue(p,1,1,()=>{p=null}),ze())},i($){L||(se(A),se(p),L=!0)},o($){ue(A),ue(p),L=!1},d($){$&&G(e),t[17](null),y&&y.d(),q[h].d(),p&&p.d(),v=!1,ve(D)}}}function Qn(t,e,o){let n,s,l;Me(t,ye,_=>o(22,n=_)),Me(t,_o,_=>o(0,s=_)),Me(t,Ue,_=>o(7,l=_));let r="",i=null,a=[],c=!1,f="",d=[],m=0,I;function h(_){A(_.target)}function A(_){const K=_.selectionStart,x=_.value,S=x.lastIndexOf("@",K-1);if(S!==-1){const k=x.slice(S+1,K);if(!k.includes(" ")){o(3,c=!0),o(15,f=k),o(5,m=0);return}}o(3,c=!1),o(15,f="")}function w(_){if(!I)return;const K=I.selectionStart,x=r,S=x.lastIndexOf("@",K-1);if(S!==-1){const k=x.slice(0,S),Z=x.slice(K);o(1,r=`${k}@${_} ${Z}`),o(3,c=!1),o(15,f=""),setTimeout(()=>{I.focus();const P=S+_.length+2;I.setSelectionRange(P,P)},0)}}function L(){if(r.trim()){we(r,{name:"Mayor",isSystem:!0});const _=cn(r);if(_){const K=n.find(x=>x.name.toLowerCase()===_.toLowerCase()&&!x.left);K&&an(K.name,r)}o(1,r="")}}function v(_){if(c&&d.length>0){if(_.key==="ArrowDown"){_.preventDefault(),o(5,m=(m+1)%d.length);return}if(_.key==="ArrowUp"){_.preventDefault(),o(5,m=(m-1+d.length)%d.length);return}if(_.key==="Enter"||_.key==="Tab"){_.preventDefault(),w(d[m]);return}if(_.key==="Escape"){_.preventDefault(),o(3,c=!1);return}}_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),L())}function D(_){_.isSystem||o(2,i=_)}function y(){o(2,i=null)}function F(_){go.call(this,t,_)}function q(_){ct[_?"unshift":"push"](()=>{I=_,o(6,I)})}function T(){r=this.value,o(1,r)}const p=_=>w(_),$=_=>o(5,m=_),j=_=>D(_.author);return t.$$.update=()=>{if(t.$$.dirty[0]&1){const _=new Set;s.forEach(K=>{K.author&&K.author.name&&_.add(K.author.name)}),o(14,a=Array.from(_).sort())}t.$$.dirty[0]&49152&&(f?o(4,d=a.filter(_=>_.toLowerCase().includes(f.toLowerCase())).slice(0,5)):o(4,d=a.slice(0,5)))},[s,r,i,c,d,m,I,l,h,w,L,v,D,y,a,f,F,q,T,p,$,j]}class Xn extends Ee{constructor(e){super(),De(this,e,Qn,Vn,Te,{},null,[-1,-1])}}function es(t){let e,o,n,s,l,r,i,a,c,f,d,m,I,h,A;return o=new bn({}),r=new Cn({}),c=new Nn({}),m=new Xn({}),{c(){e=g("div"),Ne(o.$$.fragment),n=N(),s=g("div"),l=g("main"),Ne(r.$$.fragment),i=N(),a=g("div"),Ne(c.$$.fragment),f=N(),d=g("aside"),Ne(m.$$.fragment),I=N(),h=g("div"),h.innerHTML='Lovingly built with <a href="https://multi.dev" target="_blank" rel="noopener noreferrer" class="svelte-1ot9gab">Multi</a>',M(a,"class","game-board svelte-1ot9gab"),M(l,"class","svelte-1ot9gab"),M(d,"class","svelte-1ot9gab"),M(s,"class","content-wrapper svelte-1ot9gab"),M(h,"class","plug svelte-1ot9gab"),M(e,"class","app-container svelte-1ot9gab")},m(w,L){U(w,e,L),$e(o,e,null),u(e,n),u(e,s),u(s,l),$e(r,l,null),u(l,i),u(l,a),$e(c,a,null),u(s,f),u(s,d),$e(m,d,null),u(e,I),u(e,h),A=!0},p:J,i(w){A||(se(o.$$.fragment,w),se(r.$$.fragment,w),se(c.$$.fragment,w),se(m.$$.fragment,w),A=!0)},o(w){ue(o.$$.fragment,w),ue(r.$$.fragment,w),ue(c.$$.fragment,w),ue(m.$$.fragment,w),A=!1},d(w){w&&G(e),Se(o),Se(r),Se(c),Se(m)}}}function ts(t){let e;return Eo(()=>{e=setInterval(()=>{un()},250)}),jo(()=>{e&&clearInterval(e)}),[]}class os extends Ee{constructor(e){super(),De(this,e,ts,es,Te,{})}}new os({target:document.getElementById("app")});
